{"version":3,"sources":["../src/course_conditionals-lazy.js"],"names":["define","$","ajax","notification","templates","ajaxNotify","init","courseConfig","currentlyUnavailableSections","unavailablesections","map","Number","currentlyUnavailableMods","unavailablemods","document","on","call","methodname","args","courseshortname","shortname","join","done","response","updateModOrSectionHTML","changedHTML","typeKey","Object","keys","length","i","item","id","number","html","replaceWith","changedsectionhtml","changedmodhtml","render","toc","result","trigger","split","fail","ifErrorShowBestMsg"],"mappings":"AAwBAA,OAAM,uCAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,mBAAxB,CAA6C,gBAA7C,CAA+D,8BAA/D,CAAD,CACF,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAgCC,CAAhC,CAA2CC,CAA3C,CAAuD,CAiEnD,MA9DW,SAAPC,CAAAA,IAAO,CAASC,CAAT,CAAuB,CAC9B,GAAIC,CAAAA,CAA4B,CAAGD,CAAY,CAACE,mBAAb,CAAiCC,GAAjC,CAAqCC,MAArC,CAAnC,CACAC,CAAwB,CAAGL,CAAY,CAACM,eAAb,CAA6BH,GAA7B,CAAiCC,MAAjC,CAD3B,CAGAV,CAAC,CAACa,QAAD,CAAD,CAAYC,EAAZ,CAAe,4BAAf,CACI,UAAW,CACPb,CAAI,CAACc,IAAL,CAAU,CACN,CACIC,UAAU,CAAE,8BADhB,CAEIC,IAAI,CAAE,CACFC,eAAe,CAAEZ,CAAY,CAACa,SAD5B,CAEFX,mBAAmB,CAAED,CAA4B,CAACa,IAA7B,CAAkC,GAAlC,CAFnB,CAGFR,eAAe,CAAED,CAAwB,CAACS,IAAzB,CAA8B,GAA9B,CAHf,CAFV,CAOIC,IAAI,CAAE,cAASC,CAAT,CAAmB,CAQrB,GAAIC,CAAAA,CAAsB,CAAG,SAASC,CAAT,CAAsBC,CAAtB,CAA+B,CACxD,GAAI,CAACC,MAAM,CAACC,IAAP,CAAYH,CAAZ,EAAyBI,MAA9B,CAAsC,CAElC,MACH,CACD,IAAK,GAAIC,CAAAA,CAAT,GAAcL,CAAAA,CAAd,CAA2B,IACnBM,CAAAA,CAAI,CAAGN,CAAW,CAACK,CAAD,CADC,CAEnBE,CAAE,CAAGD,CAAI,CAACC,EAAL,CAAUD,CAAI,CAACC,EAAf,CAAoBD,CAAI,CAACE,MAFX,CAGnBC,CAAI,CAAGH,CAAI,CAACG,IAHO,CAKvBjC,CAAC,CADkB,IAAMyB,CAAN,CAAgB,GAAhB,CAAsBM,CACxC,CAAD,CAAgBG,WAAhB,CAA4BD,CAA5B,CACH,CACJ,CAZD,CAeAV,CAAsB,CAACD,CAAQ,CAACa,kBAAV,CAA8B,SAA9B,CAAtB,CAGAZ,CAAsB,CAACD,CAAQ,CAACc,cAAV,CAA0B,QAA1B,CAAtB,CAGAjC,CAAS,CAACkC,MAAV,CAAiB,uBAAjB,CAA0Cf,CAAQ,CAACgB,GAAnD,EACKjB,IADL,CACU,SAASkB,CAAT,CAAiB,CACnBvC,CAAC,CAAC,aAAD,CAAD,CAAiBiC,IAAjB,CAAsBjC,CAAC,CAACuC,CAAD,CAAD,CAAUN,IAAV,EAAtB,EACAjC,CAAC,CAACa,QAAD,CAAD,CAAY2B,OAAZ,CAAoB,iBAApB,CACH,CAJL,EAOAjC,CAA4B,CAAGe,CAAQ,CAACd,mBAAT,CAA6BiC,KAA7B,CAAmC,GAAnC,EAAwChC,GAAxC,CAA4CC,MAA5C,CAA/B,CACAC,CAAwB,CAAGW,CAAQ,CAACV,eAAT,CAAyB6B,KAAzB,CAA+B,GAA/B,EAAoChC,GAApC,CAAwCC,MAAxC,CAE9B,CA9CL,CA+CIgC,IAAI,CAAE,cAASpB,CAAT,CAAmB,CACrBlB,CAAU,CAACuC,kBAAX,CAA8BrB,CAA9B,CACH,CAjDL,CADM,CAAV,OAqDH,CAvDL,CAyDH,CAEJ,CAnEC,CAAN","sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package   theme_snap\n * @copyright Copyright (c) 2016 Blackboard Inc. (http://www.blackboard.com)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Course conditionals function.\n */\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/templates', 'theme_snap/ajax_notification'],\n    function($, ajax, notification, templates, ajaxNotify) {\n\n        // Main function.\n        var init = function(courseConfig) {\n            var currentlyUnavailableSections = courseConfig.unavailablesections.map(Number),\n            currentlyUnavailableMods = courseConfig.unavailablemods.map(Number);\n\n            $(document).on(\"snapModuleCompletionChange\",\n                function() {\n                    ajax.call([\n                        {\n                            methodname: 'theme_snap_course_completion',\n                            args: {\n                                courseshortname: courseConfig.shortname,\n                                unavailablesections: currentlyUnavailableSections.join(','),\n                                unavailablemods: currentlyUnavailableMods.join(',')\n                            },\n                            done: function(response) {\n                                /**\n                                 * Update elements with newly available / unavailable html.\n                                 * Elements can either be sections or modules.\n                                 *\n                                 * @param {object} changedHTML - response json\n                                 * @param {string} typeKey - string (either 'section' or 'module')\n                                 */\n                                var updateModOrSectionHTML = function(changedHTML, typeKey) {\n                                    if (!Object.keys(changedHTML).length) {\n                                        // There are no newly available elements which require updating.\n                                        return;\n                                    }\n                                    for (var i in changedHTML) {\n                                        var item = changedHTML[i];\n                                        var id = item.id ? item.id : item.number;\n                                        var html = item.html;\n                                        var baseSelector = '#' + typeKey + '-' + id;\n                                        $(baseSelector).replaceWith(html);\n                                    }\n                                };\n\n                                // Update newly available sections with released html.\n                                updateModOrSectionHTML(response.changedsectionhtml, 'section');\n\n                                // Update newly available modules with released html.\n                                updateModOrSectionHTML(response.changedmodhtml, 'module');\n\n                                // Update TOC.\n                                templates.render('theme_snap/course_toc', response.toc)\n                                    .done(function(result) {\n                                        $('#course-toc').html($(result).html());\n                                        $(document).trigger('snapTOCReplaced');\n                                    });\n\n                                // Update current state.\n                                currentlyUnavailableSections = response.unavailablesections.split(',').map(Number);\n                                currentlyUnavailableMods = response.unavailablemods.split(',').map(Number);\n\n                            },\n                            fail: function(response) {\n                                ajaxNotify.ifErrorShowBestMsg(response);\n                            }\n                        }\n                    ], true, true);\n                }\n            );\n        };\n        return init;\n    }\n);\n"],"file":"course_conditionals-lazy.min.js"}