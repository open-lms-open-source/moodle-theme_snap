{"version":3,"sources":["../src/dndupload-lazy.js"],"names":["define","$","YUI","util","self","dndupload","init","options","whenTrue","M","course_dndupload","use","Y","decorateCourseDNDUpload","themeSnapCourseFileHandlers","handlers","extensions","newfilehandlers","h","filehandlers","handler","module","indexOf","extension","toLowerCase","push","change","sectionnumber","attr","replace","section","one","file","i","files","length","item","handle_file"],"mappings":"AAyBAA,OAAM,6BAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,iBAAvB,CAAD,CACF,SAASC,CAAT,CAAYC,CAAZ,CAAiBC,CAAjB,CAAuB,CACnB,GAAIC,CAAAA,CAAI,CAAG,IAAX,CAEAA,CAAI,CAACC,SAAL,CAAiB,IAAjB,CAMAD,CAAI,CAACE,IAAL,CAAY,SAASC,CAAT,CAAkB,CAC1BJ,CAAI,CAACK,QAAL,CACI,UAAW,CACP,MAAuC,WAAhC,QAAQC,CAAAA,CAAC,CAACC,gBACpB,CAHL,CAII,UAAW,CACPN,CAAI,CAACC,SAAL,CAAiBI,CAAC,CAACC,gBAAnB,CAEAR,CAAG,CAACS,GAAJ,CAAQ,MAAR,CAAgB,OAAhB,CAAyB,MAAzB,CAAiC,MAAjC,CAAyC,gCAAzC,CAA2E,SAASC,CAAT,CAAY,CACnFR,CAAI,CAACS,uBAAL,CAA6BD,CAA7B,CAAgCL,CAAhC,CACH,CAFD,CAIH,CAXL,IAYH,CAbD,CAoBAH,CAAI,CAACS,uBAAL,CAA+B,SAASD,CAAT,CAAYL,CAAZ,CAAqB,CAGhD,GAA2C,WAAvC,QAAOO,CAAAA,2BAAP,EAAsDA,2BAA1D,CAAuF,CACnFP,CAAO,CAACQ,QAAR,CAAmBD,2BACtB,CAFD,IAEO,CACHP,CAAO,CAACQ,QAAR,CAAmB,EACtB,CAP+C,GAU5CC,CAAAA,CAAU,CAAG,CAAC,KAAD,CAAQ,KAAR,CAAe,KAAf,CAAsB,MAAtB,CAA8B,KAA9B,CAAqC,KAArC,CAA4C,MAA5C,CAAoD,MAApD,CAA4D,KAA5D,CAV+B,CAW5CC,CAAe,CAAG,EAX0B,CAYhD,IAAK,GAAIC,CAAAA,CAAT,GAAcX,CAAAA,CAAO,CAACQ,QAAR,CAAiBI,YAA/B,CAA6C,CACzC,GAAIC,CAAAA,CAAO,CAAGb,CAAO,CAACQ,QAAR,CAAiBI,YAAjB,CAA8BD,CAA9B,CAAd,CACA,GAAIE,CAAO,EAAIA,CAAO,CAACC,MAAvB,CAA+B,CAE3B,GAAuB,OAAnB,GAAAD,CAAO,CAACC,MAAR,EAAsF,CAAC,CAAzD,GAAAL,CAAU,CAACM,OAAX,CAAmBF,CAAO,CAACG,SAAR,CAAkBC,WAAlB,EAAnB,CAAlC,CAA8F,CAC1FP,CAAe,CAACQ,IAAhB,CAAqBL,CAArB,CACH,CACJ,CACJ,CACDb,CAAO,CAACQ,QAAR,CAAiBI,YAAjB,CAAgCF,CAAhC,CAEAb,CAAI,CAACC,SAAL,CAAeC,IAAf,CAAoBM,CAApB,CAAuBL,CAAvB,EAEAN,CAAC,CAAC,oBAAD,CAAD,CAAwByB,MAAxB,CAA+B,UAAW,CAKtC,OAJIC,CAAAA,CAAa,CAAG1B,CAAC,CAAC,IAAD,CAAD,CAAQ2B,IAAR,CAAa,IAAb,EAAmBC,OAAnB,CAA2B,iBAA3B,CAA8C,EAA9C,CAIpB,CAHIC,CAAO,CAAGlB,CAAC,CAACmB,GAAF,CAAM,YAAcJ,CAApB,CAGd,CADIK,CACJ,CAASC,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG,KAAKC,KAAL,CAAWC,MAA/B,CAAuCF,CAAC,EAAxC,CAA4C,CAExCD,CAAI,CAAG,KAAKE,KAAL,CAAWE,IAAX,CAAgBH,CAAhB,CAAP,CACA7B,CAAI,CAACC,SAAL,CAAegC,WAAf,CAA2BL,CAA3B,CAAiCF,CAAjC,CAA0CH,CAA1C,CAEH,CACJ,CAXD,CAYH,CArCD,CAuCA,MAAO,CACHrB,IAAI,CAAEF,CAAI,CAACE,IADR,CAGV,CAxEC,CAAN","sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package   theme_snap\n * @author    David Castro <david.castro@blackboard.com>\n * @copyright Copyright (c) 2017 Blackboard Inc.\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module theme_snap/dndupload-lazy\n */\ndefine(['jquery', 'core/yui', 'theme_snap/util'],\n    function($, YUI, util) {\n        var self = this;\n\n        self.dndupload = null;\n\n        /**\n         * Initialising function.\n         * @param {array} options The course dnd options\n         */\n        self.init = function(options) {\n            util.whenTrue(\n                function() {\n                    return typeof (M.course_dndupload) !== 'undefined';\n                },\n                function() {\n                    self.dndupload = M.course_dndupload;\n                    // Adding YUI 3 requirements here.\n                    YUI.use('node', 'event', 'json', 'anim', 'moodle-core-notification-alert', function(Y) {\n                        self.decorateCourseDNDUpload(Y, options);\n                    });\n\n                }, true);\n        };\n\n        /**\n         * Decorates the file handlers of course drag and drop widget.\n         * @param {object} Y\n         * @param {object} options\n         */\n        self.decorateCourseDNDUpload = function(Y, options) {\n            // Add the statically added file handlers.\n            /* global themeSnapCourseFileHandlers */\n            if (typeof(themeSnapCourseFileHandlers) != \"undefined\" && themeSnapCourseFileHandlers) {\n                options.handlers = themeSnapCourseFileHandlers;\n            } else {\n                options.handlers = {};\n            }\n\n            // Rebuild file handlers without annoying label handler.\n            var extensions = ['gif', 'jpe', 'jpg', 'jpeg', 'png', 'svg', 'svgz', 'webp', 'mp3'];\n            var newfilehandlers = [];\n            for (var h in options.handlers.filehandlers) {\n                var handler = options.handlers.filehandlers[h];\n                if (handler && handler.module) {\n                    // Prevent label img dialog from showing.\n                    if (handler.module !== 'label' || extensions.indexOf(handler.extension.toLowerCase()) === -1) {\n                        newfilehandlers.push(handler);\n                    }\n                }\n            }\n            options.handlers.filehandlers = newfilehandlers;\n\n            self.dndupload.init(Y, options);\n\n            $('.js-snap-drop-file').change(function() {\n                var sectionnumber = $(this).attr('id').replace('snap-drop-file-', '');\n                var section = Y.one('#section-' + sectionnumber);\n\n                var file;\n                for (var i = 0; i < this.files.length; i++) {\n                    // Get file and trigger upload.\n                    file = this.files.item(i);\n                    self.dndupload.handle_file(file, section, sectionnumber);\n\n                }\n            });\n        };\n\n        return {\n            init: self.init\n        };\n    }\n);\n"],"file":"dndupload-lazy.min.js"}