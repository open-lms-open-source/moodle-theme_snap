{"version":3,"file":"util.min.js","sources":["../src/util.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package\n * @copyright Copyright (c) 2016 Open LMS (https://www.openlms.net)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/templates', 'core/str'], function($, templates, str) {\n\n    var staticSupportsSessionStorage = null;\n\n    /**\n     * General utilities library.\n     */\n    return {\n        /**\n         * On function evaluating true.\n         *\n         * @param {function} func\n         * @param {function} callBack\n         * @param {boolean} forceCallBack\n         * @param {number} maxIterations\n         * @param {number} i\n         */\n        whenTrue: function(func, callBack, forceCallBack, maxIterations, i) {\n            maxIterations = !maxIterations ? 10 : maxIterations;\n            i = !i ? 0 : i + 1;\n            if (i > maxIterations) {\n                // Error, too long waiting for function to evaluate true.\n                if (forceCallBack) {\n                    callBack();\n                }\n                return;\n            }\n            if (func()) {\n                callBack();\n            } else {\n                var self = this;\n                window.setTimeout(function() {\n                    self.whenTrue(func, callBack, forceCallBack, maxIterations, i);\n                }, 200);\n            }\n        },\n\n        /**\n         * Scroll a specific dom element into the viewport.\n         * @param {Object} el\n         */\n        scrollToElement: function(el) {\n            var navheight = $('#mr-nav').outerHeight();\n\n            if (!el.length) {\n                // Element does not exist so exit.\n                return;\n            }\n            if (el.length > 1) {\n                // If collection has more than one element then exit - we can't scroll to more than one element!\n                return;\n            }\n            var scrtop = el.offset().top - navheight;\n            $('html, body').animate({\n                scrollTop: scrtop\n            }, 600);\n        },\n\n        /**\n         * Does the browser support session storage?\n         * @returns {null|bool}\n         */\n        supportsSessionStorage: function() {\n            if (staticSupportsSessionStorage !== null) {\n                return staticSupportsSessionStorage;\n            }\n            if (typeof window.sessionStorage === 'object') {\n                try {\n                    window.sessionStorage.setItem('sessionStorage', 1);\n                    window.sessionStorage.removeItem('sessionStorage');\n                    staticSupportsSessionStorage = true;\n                } catch (e) {\n                    staticSupportsSessionStorage = false;\n                }\n            }\n            return staticSupportsSessionStorage;\n        },\n\n        /**\n         * Process all animated images (GIFs).\n         */\n        processAnimatedImages: function() {\n            // Put animated images in a wrap if necessary.\n            let gifs = $('img[src$=\".gif\"]:not(.texrender):not(.snap-feature-image)');\n            // Use main page and course page.\n            const indexPage = $('#page-site-index');\n            const coursePage = $('.path-course-view');\n            if (indexPage.length || coursePage.length) {\n                gifs.each(function() {\n                    if (!$(this).parent().hasClass('snap-animated-image')) {\n                        $(this).wrap('<div class=\"snap-animated-image\"></div>');\n                        let animImage = $(this).parent();\n                        (function() {\n                            return str.get_strings([\n                                {key: 'pausegraphicsanim', component: 'theme_snap'},\n                                {key: 'resumegraphicsanim', component: 'theme_snap'},\n                            ]);\n                        })()\n                            .then(function(localizedstrings) {\n                                return templates.render('theme_snap/animated_graphics_pause', {\n                                    pausegraphicsanim: localizedstrings[0],\n                                    resumegraphicsanim: localizedstrings[1],\n                                });\n                            })\n                            .then(function(html) {\n                                animImage.append(html);\n                                // Add events to hide/show the buttons to control if is GIF paused or not.\n                                var playButtons = animImage.find('.anim-play-resume-buttons');\n                                // Buttons are hidden by default.\n                                playButtons.css('display', 'none');\n                                animImage.mouseover(function() {\n                                    playButtons.css('display', 'inline-block');\n                                });\n                                animImage.mouseout(function() {\n                                    playButtons.css('display', 'none');\n                                });\n                                animImage.focusin(function() {\n                                    playButtons.css('display', 'inline-block');\n                                });\n                            });\n                    }\n                });\n            }\n        },\n\n        /**\n         * Adds the correct section return to the modchooser, so use it only where it makes sense.\n         */\n        modchooserSectionReturn: function() {\n            if (document.querySelector('body.path-course') !== null) {\n                let choosers = document.querySelectorAll('button.section-modchooser-link');\n                if (choosers.length !== 0) {\n                    choosers.forEach(el => {\n                        el.addEventListener('click', e => {\n                            let sectionNum = e.target.closest('[data-sectionid]').getAttribute('data-sectionid');\n                            let modchooserObserver = new MutationObserver(function() {\n                                let loadedModules = document.querySelectorAll('[role=\"menuitem\"]' +\n                                    ' [data-region=\"chooser-option-info-container\"]' +\n                                    ' a[data-action=\"add-chooser-option\"]');\n                                if (loadedModules.length > 0) {\n                                    loadedModules.forEach(el => {\n                                        let link = el.href + '&sr=' + sectionNum;\n                                        el.setAttribute('href', link);\n                                    });\n                                }\n                            });\n                            let modchooserObserverConfig = {\n                                childList: true,\n                                subtree: true,\n                            };\n                            modchooserObserver.observe(document.body, modchooserObserverConfig);\n                        });\n                    });\n                }\n            }\n        }\n    };\n});\n"],"names":["define","$","templates","str","staticSupportsSessionStorage","whenTrue","func","callBack","forceCallBack","maxIterations","i","self","this","window","setTimeout","scrollToElement","el","navheight","outerHeight","length","scrtop","offset","top","animate","scrollTop","supportsSessionStorage","sessionStorage","setItem","removeItem","e","processAnimatedImages","gifs","indexPage","coursePage","each","parent","hasClass","wrap","animImage","get_strings","key","component","then","localizedstrings","render","pausegraphicsanim","resumegraphicsanim","html","append","playButtons","find","css","mouseover","mouseout","focusin","modchooserSectionReturn","document","querySelector","choosers","querySelectorAll","forEach","addEventListener","sectionNum","target","closest","getAttribute","modchooserObserver","MutationObserver","loadedModules","link","href","setAttribute","observe","body","childList","subtree"],"mappings":";;;;;;;;;;;;;;;;;;;;AAqBAA,yBAAO,CAAC,SAAU,iBAAkB,aAAa,SAASC,EAAGC,UAAWC,SAEhEC,6BAA+B,WAK5B,CAUHC,SAAU,SAASC,KAAMC,SAAUC,cAAeC,cAAeC,OAE7DA,EAAKA,EAAQA,EAAI,EAAR,IADTD,cAAiBA,eAAgB,IAIzBD,eACAD,mBAIJD,OACAC,eACG,KACCI,KAAOC,KACXC,OAAOC,YAAW,WACdH,KAAKN,SAASC,KAAMC,SAAUC,cAAeC,cAAeC,KAC7D,OAQXK,gBAAiB,SAASC,QAClBC,UAAYhB,EAAE,WAAWiB,iBAExBF,GAAGG,UAIJH,GAAGG,OAAS,QAIZC,OAASJ,GAAGK,SAASC,IAAML,UAC/BhB,EAAE,cAAcsB,QAAQ,CACpBC,UAAWJ,QACZ,OAOPK,uBAAwB,cACiB,OAAjCrB,oCACOA,gCAE0B,iBAA1BS,OAAOa,mBAEVb,OAAOa,eAAeC,QAAQ,iBAAkB,GAChDd,OAAOa,eAAeE,WAAW,kBACjCxB,8BAA+B,EACjC,MAAOyB,GACLzB,8BAA+B,SAGhCA,8BAMX0B,sBAAuB,eAEfC,KAAO9B,EAAE,mEAEP+B,UAAY/B,EAAE,oBACdgC,WAAahC,EAAE,sBACjB+B,UAAUb,QAAUc,WAAWd,SAC/BY,KAAKG,MAAK,eACDjC,EAAEW,MAAMuB,SAASC,SAAS,uBAAwB,CACnDnC,EAAEW,MAAMyB,KAAK,+CACTC,UAAYrC,EAAEW,MAAMuB,SAEbhC,IAAIoC,YAAY,CACnB,CAACC,IAAK,oBAAqBC,UAAW,cACtC,CAACD,IAAK,qBAAsBC,UAAW,gBAG1CC,MAAK,SAASC,yBACJzC,UAAU0C,OAAO,qCAAsC,CAC1DC,kBAAmBF,iBAAiB,GACpCG,mBAAoBH,iBAAiB,QAG5CD,MAAK,SAASK,MACXT,UAAUU,OAAOD,UAEbE,YAAcX,UAAUY,KAAK,6BAEjCD,YAAYE,IAAI,UAAW,QAC3Bb,UAAUc,WAAU,WAChBH,YAAYE,IAAI,UAAW,mBAE/Bb,UAAUe,UAAS,WACfJ,YAAYE,IAAI,UAAW,WAE/Bb,UAAUgB,SAAQ,WACdL,YAAYE,IAAI,UAAW,2BAWvDI,wBAAyB,cAC8B,OAA/CC,SAASC,cAAc,oBAA8B,KACjDC,SAAWF,SAASG,iBAAiB,kCACjB,IAApBD,SAASvC,QACTuC,SAASE,SAAQ5C,KACbA,GAAG6C,iBAAiB,SAAShC,QACrBiC,WAAajC,EAAEkC,OAAOC,QAAQ,oBAAoBC,aAAa,kBAC/DC,mBAAqB,IAAIC,kBAAiB,eACtCC,cAAgBZ,SAASG,iBAAiB,uGAG1CS,cAAcjD,OAAS,GACvBiD,cAAcR,SAAQ5C,SACdqD,KAAOrD,GAAGsD,KAAO,OAASR,WAC9B9C,GAAGuD,aAAa,OAAQF,YAQpCH,mBAAmBM,QAAQhB,SAASiB,KAJL,CAC3BC,WAAW,EACXC,SAAS"}