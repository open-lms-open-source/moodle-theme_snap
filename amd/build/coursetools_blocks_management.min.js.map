{"version":3,"file":"coursetools_blocks_management.min.js","sources":["../src/coursetools_blocks_management.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package\n * @author    Daniel Cifuentes <daniel.cifuentes@openlms.net>\n * @copyright Copyright (c) 2024 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module theme_snap/coursetools_blocks_management\n */\ndefine(['core/ajax'],\n    function(ajax) {\n        var self = this;\n\n        /**\n         * Modifies block editing actions so that they are redirected to the Course Dashboard when triggered.\n         * @param {object} courseConfig\n         */\n        self.init = function(courseConfig) {\n\n            const blockActions = document.querySelectorAll(\n                '.block-controls .editing_hide, ' +\n                '.block-controls .editing_show, ' +\n                '.block-controls .editing_delete'\n            );\n            blockActions.forEach(function(button) {\n                button.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    const href = button.getAttribute('href');\n                    const urlParams = new URLSearchParams(href.split('?')[1]);\n                    const bui_hideid = urlParams.get('bui_hideid');\n                    const bui_showid = urlParams.get('bui_showid');\n                    const bui_deleteid = urlParams.get('bui_deleteid');\n                    // The button to hide the block.\n                    if (bui_hideid !== null) {\n                        self.manageAjaxCall('bui_hideid', bui_hideid, courseConfig);\n                    }\n                    // The button to show the block.\n                    if (bui_showid !== null) {\n                        self.manageAjaxCall('bui_showid', bui_showid, courseConfig);\n                    }\n                    // The button to delete the block.\n                    if (bui_deleteid !== null) {\n                        // There is a confirmation modal that is displayed once the user clicks on the delete button.\n                        // For this reason, we need to observe when that modal appears in order to modify the delete\n                        // action.\n                        const observer = new MutationObserver(\n                            (mutationsList, observer) => {\n                            for (const mutation of mutationsList) {\n                                if (mutation.type === 'childList') {\n                                    const confirmButton = document.querySelector('.modal [data-action=\"save\"]');\n                                    if (confirmButton) {\n                                        observer.disconnect();\n                                        confirmButton.addEventListener('click', function(event) {\n                                            event.stopPropagation();\n                                            confirmButton.removeAttribute('data-action');\n                                            self.manageAjaxCall('bui_deleteid', bui_deleteid, courseConfig);\n                                        });\n                                    }\n                                }\n                            }\n                        });\n                        observer.observe(document.body, {childList: true, subtree: true});\n                    }\n                });\n            });\n        };\n        /**\n         * Manages the AJAX call responsible for modifying the block editing action.\n         * @param {string} action\n         * @param {int} id\n         * @param {object} courseConfig\n         */\n        self.manageAjaxCall = function(action, id, courseConfig) {\n            var ajaxParams = {};\n            ajaxParams.action = action;\n            ajaxParams.id = id;\n            ajaxParams.courseid = courseConfig.id;\n            ajax.call([{\n                methodname: \"theme_snap_coursetools_block_actions\",\n                args: {params: ajaxParams},\n                done: function(response) {\n                    if (response.success) {\n                        location.reload();\n                    }\n                },\n            }]);\n        };\n        return {\n            init: self.init\n        };\n    }\n);\n"],"names":["define","ajax","self","this","init","courseConfig","document","querySelectorAll","forEach","button","addEventListener","e","preventDefault","href","getAttribute","urlParams","URLSearchParams","split","bui_hideid","get","bui_showid","bui_deleteid","manageAjaxCall","MutationObserver","mutationsList","observer","mutation","type","confirmButton","querySelector","disconnect","event","stopPropagation","removeAttribute","observe","body","childList","subtree","action","id","ajaxParams","courseid","call","methodname","args","params","done","response","success","location","reload"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAyBAA,kDAAO,CAAC,cACJ,SAASC,UACDC,KAAOC,YAMXD,KAAKE,KAAO,SAASC,cAEIC,SAASC,iBAC1B,iGAISC,SAAQ,SAASC,QAC1BA,OAAOC,iBAAiB,SAAS,SAASC,GACtCA,EAAEC,uBACIC,KAAOJ,OAAOK,aAAa,QAC3BC,UAAY,IAAIC,gBAAgBH,KAAKI,MAAM,KAAK,IAChDC,WAAaH,UAAUI,IAAI,cAC3BC,WAAaL,UAAUI,IAAI,cAC3BE,aAAeN,UAAUI,IAAI,mBAEhB,OAAfD,YACAhB,KAAKoB,eAAe,aAAcJ,WAAYb,cAG/B,OAAfe,YACAlB,KAAKoB,eAAe,aAAcF,WAAYf,cAG7B,OAAjBgB,aAAuB,CAIN,IAAIE,kBACjB,CAACC,cAAeC,gBACX,MAAMC,YAAYF,iBACG,cAAlBE,SAASC,KAAsB,OACzBC,cAAgBtB,SAASuB,cAAc,+BACzCD,gBACAH,SAASK,aACTF,cAAclB,iBAAiB,SAAS,SAASqB,OAC7CA,MAAMC,kBACNJ,cAAcK,gBAAgB,eAC9B/B,KAAKoB,eAAe,eAAgBD,aAAchB,sBAM7D6B,QAAQ5B,SAAS6B,KAAM,CAACC,WAAW,EAAMC,SAAS,YAW3EnC,KAAKoB,eAAiB,SAASgB,OAAQC,GAAIlC,kBACnCmC,WAAa,GACjBA,WAAWF,OAASA,OACpBE,WAAWD,GAAKA,GAChBC,WAAWC,SAAWpC,aAAakC,GACnCtC,KAAKyC,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,CAACC,OAAQL,YACfM,KAAM,SAASC,UACPA,SAASC,SACTC,SAASC,cAKlB,CACH9C,KAAMF,KAAKE"}