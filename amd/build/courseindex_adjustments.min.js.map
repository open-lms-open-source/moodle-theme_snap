{"version":3,"file":"courseindex_adjustments.min.js","sources":["../src/courseindex_adjustments.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Additional settings in the course index.\n *\n * @module theme_snap/courseindex_adjustments\n * @copyright  Copyright (c) 2025 Open LMS\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport cfg from 'core/config';\n\n/**\n * Build the URL for a module icon.\n *\n * @param {string} modname - The short name of the module (e.g. quiz, forum).\n * @returns {string} The absolute URL of the icon.\n */\nconst getIconUrl = (modname) => {\n    return `${cfg.wwwroot}/theme/image.php/${cfg.theme}/${modname}/${cfg.themerev}/monologo?filtericon=1`;\n};\n\n/**\n * Injects icons into activity containers that do not already have one.\n *\n * @param {HTMLElement|Document} root - The root node to search for activity containers.\n */\nconst injectIcons = (root) => {\n    root.querySelectorAll('.activityiconcontainer[data-cmid]').forEach((container) => {\n        if (container.dataset.iconInjected) {\n            return;\n        }\n        container.dataset.iconInjected = '1';\n\n        const link = container.closest('li.courseindex-item')?.querySelector('a.courseindex-link');\n        if (!link) {\n            return;\n        }\n\n        const href = link.getAttribute('href') || '';\n        const match = href.match(/\\/mod\\/([^/]+)\\//);\n        if (!match) {\n            return;\n        }\n        const modname = match[1];\n        const iconurl = getIconUrl(modname);\n\n        const img = document.createElement('img');\n        img.src = iconurl;\n        img.alt = `${modname} icon`;\n        img.className = `${modname} icon activityicon`;\n        container.appendChild(img);\n    });\n};\n\n/**\n * Ensures that all course index links have a title attribute for accessibility.\n *\n * @param {HTMLElement|Document} root - The root node to search for course index links.\n */\nconst injectTitles = (root) => {\n    root.querySelectorAll('a.courseindex-link').forEach((link) => {\n        if (!link.hasAttribute('title')) {\n            const text = link.textContent.trim();\n            if (text) {\n                link.setAttribute('title', text);\n            }\n        }\n    });\n};\n\n/**\n * Processes a newly added node by injecting icons and titles if applicable.\n *\n * @param {Node} node - The node added to the DOM.\n */\nconst processNode = (node) => {\n    if (node.nodeType !== 1) {\n        return;\n    }\n    injectIcons(node);\n    injectTitles(node);\n};\n\n/**\n * Initializes the course index adjustments.\n *\n * - Injects icons into existing activities.\n * - Adds missing title attributes to links.\n * - Observes changes in the course index and applies the same adjustments to new nodes.\n */\nexport const init = () => {\n    injectIcons(document);\n    injectTitles(document);\n\n    const target = document.querySelector('#courseindex');\n    if (target) {\n        const observer = new MutationObserver((mutations) => {\n            mutations.forEach((m) => {\n                m.addedNodes.forEach(processNode);\n            });\n        });\n        observer.observe(target, {childList: true, subtree: true});\n    }\n};\n"],"names":["injectIcons","root","querySelectorAll","forEach","container","dataset","iconInjected","link","closest","_container$closest","querySelector","match","getAttribute","modname","iconurl","cfg","wwwroot","theme","themerev","getIconUrl","img","document","createElement","src","alt","className","appendChild","injectTitles","hasAttribute","text","textContent","trim","setAttribute","processNode","node","nodeType","target","MutationObserver","mutations","m","addedNodes","observe","childList","subtree"],"mappings":";;;;;;;gJAwCMA,YAAeC,OACjBA,KAAKC,iBAAiB,qCAAqCC,SAASC,sCAC5DA,UAAUC,QAAQC,oBAGtBF,UAAUC,QAAQC,aAAe,UAE3BC,gCAAOH,UAAUI,QAAQ,4DAAlBC,mBAA0CC,cAAc,0BAChEH,kBAKCI,OADOJ,KAAKK,aAAa,SAAW,IACvBD,MAAM,wBACpBA,mBAGCE,QAAUF,MAAM,GAChBG,QA3BMD,CAAAA,mBACNE,gBAAIC,oCAA2BD,gBAAIE,kBAASJ,oBAAWE,gBAAIG,mCA0BjDC,CAAWN,SAErBO,IAAMC,SAASC,cAAc,OACnCF,IAAIG,IAAMT,QACVM,IAAII,cAASX,iBACbO,IAAIK,oBAAeZ,8BACnBT,UAAUsB,YAAYN,SASxBO,aAAgB1B,OAClBA,KAAKC,iBAAiB,sBAAsBC,SAASI,WAC5CA,KAAKqB,aAAa,SAAU,OACvBC,KAAOtB,KAAKuB,YAAYC,OAC1BF,MACAtB,KAAKyB,aAAa,QAASH,WAWrCI,YAAeC,OACK,IAAlBA,KAAKC,WAGTnC,YAAYkC,MACZP,aAAaO,sBAUG,KAChBlC,YAAYqB,UACZM,aAAaN,gBAEPe,OAASf,SAASX,cAAc,mBAClC0B,OAAQ,CACS,IAAIC,kBAAkBC,YACnCA,UAAUnC,SAASoC,IACfA,EAAEC,WAAWrC,QAAQ8B,mBAGpBQ,QAAQL,OAAQ,CAACM,WAAW,EAAMC,SAAS"}