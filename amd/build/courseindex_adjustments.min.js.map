{"version":3,"file":"courseindex_adjustments.min.js","sources":["../src/courseindex_adjustments.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Additional settings in the course index.\n *\n * @module theme_snap/courseindex_adjustments\n * @copyright  Copyright (c) 2025 Open LMS\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ajax from \"core/ajax\";\nimport snapsection from 'theme_snap/section_asset_management';\n\n/**\n * Ensures that all course index links have a title attribute for accessibility.\n *\n * @param {HTMLElement|Document} root - The root node to search for course index links.\n */\nconst injectTitles = (root) => {\n    root.querySelectorAll('a.courseindex-link, a.aalink.stretched-link').forEach((link) => {\n        if (!link.hasAttribute('title')) {\n            const text = link.textContent.trim();\n            if (text) {\n                link.setAttribute('title', text);\n            }\n        }\n    });\n};\n\n/**\n * Processes a newly added node by injecting icons and titles if applicable.\n *\n * @param {Node} node - The node added to the DOM.\n */\nconst processNode = (node) => {\n    if (node.nodeType !== 1) {\n        return;\n    }\n    injectTitles(node);\n};\n\nconst getCourseState = async() => {\n\n    const courseStateData = await ajax.call([{\n        methodname: 'core_courseformat_get_state',\n        args: {\n            courseid: M.cfg.courseId,\n        }\n    }])[0];\n    return JSON.parse(courseStateData);\n};\n\n/**\n * Initializes the course index adjustments.\n *\n * - Adds missing title attributes to links.\n * - Observes changes in the course index and applies the same adjustments to new nodes.\n */\nexport const init = () => {\n    injectTitles(document);\n\n    const target = document.querySelector('#courseindex');\n    if (target) {\n        const observer = new MutationObserver((mutations) => {\n            snapsection.setNavigationObservers();\n            mutations.forEach((m) => {\n                m.addedNodes.forEach(processNode);\n            });\n            getCourseState().then(courseState => {\n                const sections = document.querySelectorAll('#courseindex-content .courseindex-section');\n                const currentSectionId = courseState.section.filter(el => el.current)[0]?.id;\n                sections.forEach(section => {\n                    if (currentSectionId === section.dataset.id) {\n                        section.classList.add('current');\n                        if (document.querySelector('body:not(.path-course-view-section)')) {\n                            section.querySelector('.courseindex-item').classList.add('pageitem');\n                        }\n                    } else {\n                        section.classList.remove('current');\n                        if (document.querySelector('body:not(.path-course-view-section)')) {\n                            section.querySelector('.courseindex-item').classList.remove('pageitem');\n                        }\n                    }\n                });\n            });\n            const sectionsInView = document.querySelectorAll('body:not(.path-course-view-section)' +\n                ' #courseindex-content .courseindex-section');\n            sectionsInView.forEach((section) => {\n                if (section.classList.contains('current')) {\n                    section.querySelector('.courseindex-item').classList.add('pageitem');\n                } else {\n                    section.querySelector('.courseindex-item').classList.remove('pageitem');\n                }\n            });\n        });\n        observer.observe(target, {childList: true, subtree: true});\n    }\n};\n"],"names":["injectTitles","root","querySelectorAll","forEach","link","hasAttribute","text","textContent","trim","setAttribute","processNode","node","nodeType","document","target","querySelector","MutationObserver","mutations","setNavigationObservers","m","addedNodes","async","courseStateData","ajax","call","methodname","args","courseid","M","cfg","courseId","JSON","parse","getCourseState","then","courseState","sections","currentSectionId","section","filter","el","current","_courseState$section$","id","dataset","classList","add","remove","contains","observe","childList","subtree"],"mappings":";;;;;;;wMA+BMA,aAAgBC,OAClBA,KAAKC,iBAAiB,+CAA+CC,SAASC,WACrEA,KAAKC,aAAa,SAAU,OACvBC,KAAOF,KAAKG,YAAYC,OAC1BF,MACAF,KAAKK,aAAa,QAASH,WAWrCI,YAAeC,OACK,IAAlBA,KAAKC,UAGTZ,aAAaW,qBAoBG,KAChBX,aAAaa,gBAEPC,OAASD,SAASE,cAAc,mBAClCD,OAAQ,CACS,IAAIE,kBAAkBC,8CACvBC,yBACZD,UAAUd,SAASgB,IACfA,EAAEC,WAAWjB,QAAQO,gBAzBdW,iBAEbC,sBAAwBC,cAAKC,KAAK,CAAC,CACrCC,WAAY,8BACZC,KAAM,CACFC,SAAUC,EAAEC,IAAIC,aAEpB,UACGC,KAAKC,MAAMV,kBAmBVW,GAAiBC,MAAKC,8CACZC,SAAWvB,SAASX,iBAAiB,6CACrCmC,+CAAmBF,YAAYG,QAAQC,QAAOC,IAAMA,GAAGC,UAAS,2CAA7CC,sBAAiDC,GAC1EP,SAASjC,SAAQmC,UACTD,mBAAqBC,QAAQM,QAAQD,IACrCL,QAAQO,UAAUC,IAAI,WAClBjC,SAASE,cAAc,wCACvBuB,QAAQvB,cAAc,qBAAqB8B,UAAUC,IAAI,cAG7DR,QAAQO,UAAUE,OAAO,WACrBlC,SAASE,cAAc,wCACvBuB,QAAQvB,cAAc,qBAAqB8B,UAAUE,OAAO,mBAKrDlC,SAASX,iBAAiB,iFAElCC,SAASmC,UAChBA,QAAQO,UAAUG,SAAS,WAC3BV,QAAQvB,cAAc,qBAAqB8B,UAAUC,IAAI,YAEzDR,QAAQvB,cAAc,qBAAqB8B,UAAUE,OAAO,kBAI/DE,QAAQnC,OAAQ,CAACoC,WAAW,EAAMC,SAAS"}