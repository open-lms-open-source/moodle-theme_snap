define ("theme_snap/snap",["jquery","core/log","theme_snap/headroom","theme_snap/util","theme_snap/personal_menu","theme_snap/cover_image","theme_snap/progressbar","core/templates","core/str","theme_snap/accessibility","theme_snap/messages"],function(a,b,c,d,e,f,g,h,i,j,k){'use strict';M.theme_snap=M.theme_snap||{};b.disableAll(!0);var m="",n="",o="",p="",q="",r=function(a){var b=a.split("?");if(2>b.length){return!1}var c=b[1];c=c.split("#")[0];for(var d=c.split("&"),e=[],f=0;f<d.length;f++){var g=d[f].split("="),h=g[0],j=g[1];e[h]=j}return e};a(window).on("resize",function(){s()});var s=function(){var b=a("div[role=main] .mform div.snap-form-required fieldset > div.form-group.fitem"),c=a("div[role=main] .mform div.snap-form-advanced > div:nth-of-type(3)"),d=a(window).width();if(767>d){a(".snap-form-advanced").append(b)}else if(767<d){a(".snap-form-required fieldset#id_general").append(c)}},t=function(){var b=a(".xdebug-error");if(b.length){for(var c=0;c<b.length;c++){var d=b[c],e=d.parentNode,f=a(e).prev("br");a(f).remove()}}var g=a(".xdebug-error, .php-debug, .debuggingmessage");if(g.length){a(g).addClass("php-debug-footer");var h=a("<div id=\"footer-error-cont\"><h3>"+M.util.get_string("debugerrors","theme_snap")+"</h3><hr></div>");a("#page-footer").append(h);a("#footer-error-cont").append(g);a(".php-debug-footer").after(a("<hr>"));a("#mr-nav").addClass("errors-found");var i=a("<a class=\"footer-error-link btn btn-danger\" href=\"#footer-error-cont\">"+M.util.get_string("problemsfound","theme_snap")+" <span class=\"badge\">"+g.length+"</span></a>");a("#page-header").append(i)}},u=function(){return 0===a("body").attr("id").indexOf("page-course-view-")},v=function(){if(u()){a(".block_adminblock form").each(function(){a(this).attr("action",a(this).attr("action")+"#coursetools")})}if(""!==location.hash){return}var b=r(location.href);if(u()&&"undefined"!=typeof b.time){location.hash="coursetools";if(a(".block_calendar_month")){d.scrollToElement(a(".block_calendar_month"))}}var c=["body.path-blocks-collect #notice form"],e=["bui_deleteid","bui_editid"];for(var f in e){var g=e[f];if("undefined"!=typeof b[g]){c.push("#notice form");break}}a(c.join(", ")).each(function(){var b=a(this).attr("action");if(-1===b.indexOf("#")&&-1<b.indexOf("/course/view.php")){a(this).attr("action",a(this).attr("action")+"#coursetools")}})},w=function(){a(".path-mod-forum tr.discussion td.topic.starter").attr("data-cellname",M.util.get_string("forumtopic","theme_snap"));a(".path-mod-forum tr.discussion td.picture:not('.group')").attr("data-cellname",M.util.get_string("forumauthor","theme_snap"));a(".path-mod-forum tr.discussion td.picture.group").attr("data-cellname",M.util.get_string("forumpicturegroup","theme_snap"));a(".path-mod-forum tr.discussion td.replies").attr("data-cellname",M.util.get_string("forumreplies","theme_snap"));a(".path-mod-forum tr.discussion td.lastpost").attr("data-cellname",M.util.get_string("forumlastpost","theme_snap"))},x=function(a){a=a.trim().toLowerCase();return a},y=function(b){var c,d=window.navigator.userAgent;if(d.indexOf("MSIE ")||d.indexOf("Trident/")){b=a("#toc-searchables").find("li").clone(!0)}var e=a("#toc-search-input").val();e=x(e);if(0===e.length){a("#toc-search-results").html("");a("#toc-search-input").removeClass("state-active")}else{a("#toc-search-input").addClass("state-active");var f=[];for(c=0;c<b.length;c++){var g=b[c];if(-1<x(a(g).text()).indexOf(e)){f.push(g)}}a("#toc-search-results").html(f)}},z=function(){var b=[];if(a("#notice.snap-continue-cancel").length){b.push("hascontinuecancel")}a("body").addClass(b.join(" "))},A=function(c){var d=location.hash;a(window).on("popstate hashchange",function(f){var g=location.hash;b.info("hashchange");if(g!==d){if("#primary-nav"===location.hash){e.update()}else{a("#page, #moodle-footer, #js-snap-pm-trigger, #logo, .skiplinks").css("display","");if(u()){b.info("show section",f.target);c.showSection()}}}d=g})},B=function(){a("#snap-course-footer-recent-activity .info").each(function(){a(this).appendTo(a(this).prev())});a("#snap-course-footer-recent-activity .head .name").each(function(){a(this).prependTo(a(this).closest(".head"))})},C=function(b,c){var d=new g.Circle(b,{color:"inherit",easing:"linear",strokeWidth:6,trailWidth:3,duration:1400,text:{value:"0"}}),e=a(b).attr("value")/100,f=m;if(0===e||"-"===a(b).attr("value")){d.setText("-")}else{if(50>a(b).attr("value")){f=n}d.setText(c(b))}d.animate(e,{from:{color:"#999"},to:{color:f},step:function step(a,b){b.path.setAttribute("stroke",a.color)}})},D=function(){a(".snap-student-dashboard-progress .js-progressbar-circle").each(function(){C(this,function(b){return a(b).attr("value")+"<small>%</small>"})});a(".snap-student-dashboard-grade .js-progressbar-circle").each(function(){C(this,function(b){var c=a(b).attr("value"),d=a(b).attr("gradeformat");if(d==o||d==p||d==q){c=c+"<small>%</small>"}return c})})},E=function(){a(document).on("click",[".chapters a",".section_footer a"," #toc-search-results a"].join(", "),function(b){var c=this.getAttribute("href");if(window.history&&window.history.pushState){history.pushState(null,null,c);a(window).trigger("hashchange");b.preventDefault()}else{location.hash=c}});var b=document.querySelector("#mr-nav"),e=new c(b,{tolerance:5,offset:100,classes:{initial:"headroom",pinned:"headroom--pinned",unpinned:"headroom--unpinned",top:"headroom--top",notTop:"headroom--not-top"}});if(!a(".notloggedin").length){e.init()}var f=a("#toc-searchables").find("li").clone(!0);a("#course-toc").on("keyup","#toc-search-input",function(){y(f)});a("#course-toc").on("keydown","#toc-search-input",function(b){var c=b.keyCode||b.which;if(9===c){a("#toc-search-results a").last().blur(function(){a(this).off("blur");a("#toc-search-input").val("");a("#toc-search-results").html("");a("#toc-search-input").removeClass("state-active")})}});a("#course-toc").on("click","#toc-search-results a",function(){a("#toc-search-input").val("");a("#toc-search-results").html("");a("#toc-search-input").removeClass("state-active")});a(document).on("click",function(b){if(!a(b.target).closest("#toc-search-input").length){a("#toc-search-input").val("");a("#toc-search-results").html("");a("#toc-search-input").removeClass("state-active")}});a(document).on("click","#admin-menu-trigger, #toc-mobile-menu-toggle",function(b){var c=this.getAttribute("href");if("admin-menu-trigger"===this.getAttribute("id")){a(this).toggleClass("active");a("#page").toggleClass("offcanvas")}a(c).attr("tabindex","0");a(c).toggleClass("state-visible").focus();b.preventDefault();if(0===a(".message-app.main").length){document.dispatchEvent(new Event("messages-drawer:toggle"))}});a(document).on("click","#course-toc.state-visible a",function(){a("#course-toc").removeClass("state-visible")});a(document).on("click",".news-article .toggle",function(b){var c=a(this).closest(".news-article");d.scrollToElement(c);a(".news-article").not(c).removeClass("state-expanded");a(".news-article-message").css("display","none");c.toggleClass("state-expanded");a(".state-expanded").find(".news-article-message").slideDown("fast",function(){if(c.is(".state-expanded")){c.find(".news-article-message").focus();c.attr("aria-expanded","true")}else{c.focus();c.attr("aria-expanded","false")}a(document).trigger("snapContentRevealed")});b.preventDefault()});a(function(){var b=!1;if("ontouchstart"in window){b=!0}else if(window.navigator.msPointerEnabled){b=!0}if(!b){var c=a("[data-toggle=\"tooltip\"]");if(a.isFunction(c.tooltip)){c.tooltip()}}})};function l(){var b=0,c=setInterval(function(){b=b+1;if(b>15){clearInterval(c)}else{if(0!=a("button.atto_fullscreen_button").length&&0!=a("div.editor_atto").length){a("button.atto_fullscreen_button").click(function(){a("div.editor_atto").css("background-color","#eee");a("div.editor_atto").css("z-index","1")});a("button.atto_html_button").click(function(){a("#id_introeditor").css("z-index","1")});clearInterval(c)}}},2e3)}return{snapInit:function snapInit(b,c,d,g,u,x,y,C,F,G){m=F.success;n=F.warning;o=G.gradepercentage;p=G.gradepercentagereal;q=G.gradepercentageletter;M.cfg.context=b.contextid;M.snapTheme={forcePassChange:g};e.init(y);if(c){require(["theme_snap/course-lazy"],function(a){var c=new a(b);A(c)})}a(document).ready(function(){t();w();E();v();z();s();a("#page-mod-assign-view #page-content").append(a("#moodle-blocks"));a(".snap-resource-long .contentafterlink .snap-resource-card-fadeout").each(function(){a(this).appendTo(a(this).prevAll(".snap-resource-long .contentafterlink .no-overflow"))});a(".snap-header-card .snap-header-card-icons .disabled-snap-asset-completion-tracking").remove();var c=a("li.snap-activity.modtype_folder");a.each(c,function(b,c){var d=a(c).find("div.contentwithoutlink div.snap-assettype");if(0<d.length){if(0==a(c).find("div.activityinstance div.snap-header-card .asset-type").length){var e=a(c).find("div.activityinstance div.snap-header-card");d.prependTo(e)}}});a("li.snap-activity.modtype_folder td[id^=\"ygtvcontentel\"] > div > span.fp-filename").each(function(){a(this).replaceWith("<h3>"+a(this).text()+"</h3>")});a("body").addClass("snap-js-loaded");D();B();if(a("body").hasClass("pagelayout-course")||a("body").hasClass("pagelayout-frontpage")){f.courseImage(b.shortname,d)}else if(a("body").hasClass("pagelayout-coursecategory")){if(b.categoryid){f.categoryImage(b.categoryid,d)}}if(a("#page-admin-setting-themesettingsnap").length){var g=location.hash;if(g&&a(".nav-link[href=\""+g+"\"]").length){a(".nav-link[href=\""+g+"\"]").tab("show");a(window).scrollTop(0)}var j=function(b,c){var d=a(b),e=a(c);if(d.is(":checked")){e.show();return}e.hide()},k="#id_s_theme_snap_personalmenuadvancedfeedsenable",m="#admin-personalmenuadvancedfeedslifetime";j(k,m);a(k).on("click",function(){j(k,m)})}var n=a("#page-admin-setting-themesettingsnap #themesnapfeaturespots #admin-fs_one_title_link span.error"),o=a("#page-admin-setting-themesettingsnap #themesnapfeaturespots #admin-fs_two_title_link span.error"),p=a("#page-admin-setting-themesettingsnap #themesnapfeaturespots #admin-fs_three_title_link span.error"),q=a("#page-admin-setting-themesettingsnap #themesnapfeaturespots #admin-fs_one_title_link .form-label"),y=a("#page-admin-setting-themesettingsnap #themesnapfeaturespots #admin-fs_two_title_link .form-label"),A=a("#page-admin-setting-themesettingsnap #themesnapfeaturespots #admin-fs_three_title_link .form-label");a("#page-admin-setting-themesettingsnap #themesnapfeaturespots #admin-fs_three_title").nextUntil("#page-admin-setting-themesettingsnap #themesnapfeaturespots #admin-fs_one_title_link_cb").wrapAll("<div class=fs-title-links></div>");var F={"padding-bottom":"2.1em"};if(n.length){y.css(F);A.css(F)}if(o.length){q.css(F);A.css(F)}if(p.length){q.css(F);y.css(F)}if(a("body").hasClass("snap-pm-open")){e.update()}if(a("#page-course-editsection.format-topics").length){var G=document.getElementById("id_name_customize"),H=document.getElementById("id_name_value");G.value="1";G.checked=!0;H.required="required";a(H).attr("pattern",".*\\S+.*");a(G).parent().css("display","none");a("#id_cancel").on("click",function(){a(H).removeAttr("required");a(H).removeAttr("pattern");return!0})}else{a("#id_name_value").attr("pattern",".*\\S+.*");a("#id_cancel").on("click",function(){a(H).removeAttr("pattern");return!0})}if(a("#page-mod-book-view a[href*=\"mod/book/tool/print/index.php\"]").length){var I=r(location.href);if(I){a("[data-block=\"_fake\"]").append("<p><hr><a target=\"_blank\" href=\"/mod/book/tool/print/index.php?id="+I.id+"\">"+M.util.get_string("printbook","booktool_print")+"</a></p>")}}var J=/^page-mod-.*-mod$/,K=J.test(a("body").attr("id"))&&-1<location.href.indexOf("modedit");if(!K){J=/^page-mod-.*-general$/;K=J.test(a("body").attr("id"))&&-1<location.href.indexOf("modedit")}var L="page-course-edit"===a("body").attr("id"),N="page-course-editsection"===a("body").attr("id");a("#page-mod-hvp-mod .h5p-editor-iframe").parent().css({display:"block"});var O=-1===["page-mod-hvp-mod"].indexOf(a("body").attr("id"));if((K||L||N)&&O){var P=[":first","#page-course-edit #id_descriptionhdr","#id_contentsection","#id_general + #id_general","#id_content","#page-mod-choice-mod #id_optionhdr","#page-mod-workshop-mod #id_gradingsettings","#page-mod-choicegroup-mod #id_miscellaneoussettingshdr","#page-mod-choicegroup-mod #id_groups","#page-mod-scorm-mod #id_packagehdr"];P=P.join();a("form[id^=\"mform1\"] > fieldset").not(P).wrapAll("<div class=\"snap-form-advanced col-md-4\" />");a(".snap-form-advanced").append(a(".collapsible-actions"));if(!a("#page-course-edit").length){a(".snap-form-advanced fieldset").addClass("collapsed")}for(var Q=a("form[id^=\"mform1\"] fieldset:first"),R=a("form[id^=\"mform1\"] fieldset:first .fcontainer"),S=a("form[id^=\"mform1\"] > fieldset").not("form[id^=\"mform1\"] > fieldset:first"),T=0,U;T<S.length;T++){U=a(S[T]).find(".fcontainer");a(R).append(U);a(S[T]).remove()}a(Q).wrap("<div class=\"snap-form-required col-md-8\" />");var V=a("form[id^=\"mform1\"] fieldset:first .fitem_feditor:not(.required)");if(K&&V){if(0===a(["body#page-mod-assign-mod","body#page-mod-choice-mod","body#page-mod-turnitintool-mod","body#page-mod-workshop-mod"].join()).length){a(R).append(V);a(R).append(a("#fitem_id_showdescription"))}if(0<a(["body#page-mod-url-mod","body#page-mod-resource-mod","body#page-mod-folder-mod","body#page-mod-imscp-mod","body#page-mod-lightboxgallery-mod","body#page-mod-scorm-mod"].join()).length){i.get_strings([{key:"multimediacard",component:"theme_snap"}]).done(function(b){var c=b[0],d=a("[id='id_showdescription']").closest(".form-group");a(d).append(c)})}}V=a("#page-mod-resource-mod [data-fieldtype='editor']").closest(".form-group");var W=a("#page-mod-resource-mod [id='id_showdescription']").closest(".form-group");a("#page-mod-resource-mod .snap-form-advanced #id_modstandardelshdr .fcontainer").append(V);a("#page-mod-resource-mod .snap-form-advanced #id_modstandardelshdr .fcontainer").append(W);var X=a("#page-mod-assign-mod [data-fieldtype='filemanager']").closest(".form-group"),Y=a("#page-mod-assign-mod [for='id_duedate']").closest(".form-group");a("#page-mod-assign-mod .snap-form-advanced #id_modstandardelshdr .fcontainer").append(X);a("#page-mod-assign-mod .snap-form-required .fcontainer").append(Y);var Z=a("#id_visible").closest(".form-group").addClass("snap-form-visibility"),$=a(Z).find("label"),_=a(Z).find("select");a($).insertBefore(_);a($).text(M.util.get_string("visibility","theme_snap")+" ");if(a("#page-course-edit").length){var aa="";(function(){return i.get_strings([{key:"showallsectionsdisabled",component:"theme_snap"},{key:"disabled",component:"theme_snap"}])})().then(function(a){var b=a[0];aa=a[1];return h.render("theme_snap/form_alert",{type:"warning",classes:"",message:b})}).then(function(b){var c=a("[name=\"coursedisplay\"] > option[value=\"0\"]"),d=a("[name=\"coursedisplay\"] > option[value=\"1\"]"),e=a("[name=\"coursedisplay\"]");c.attr("disabled","disabled");c.append(" ("+aa+")");c.removeAttr("selected");d.attr("selected","selected");e.parent().append(b)})}a(".snap-form-advanced").prepend(Z);var ba=a("form[id^=\"mform1\"] > .form-group:last");a(Q).append(ba);var ca=a(".form-group.has-danger");if(K&&ca.length){ca.closest(".collapsible").removeClass("collapsed")}if(a("#page-mod-page-mod").length){(function(){return i.get_strings([{key:"showappearancedisabled",component:"theme_snap"}])})().then(function(a){return h.render("theme_snap/form_alert",{type:"warning",classes:"",message:a})}).then(function(b){var c=a("[id=\"id_printheading\"], [id=\"id_printintro\"], [id=\"id_printlastmodified\"]");c.attr("readonly",!0);c.attr("tabindex",-1);c.click(function(a){a.preventDefault();return!1});c.parent().parent().parent().css("background-color","#f1f1f1");c.parent().parent().parent().css("color","#d5d5d5");var d=a("[id=\"id_error_printheading\"]");d.parent().parent().parent().append(b)})}}if(u){require(["theme_snap/conversation_badge_count-lazy"],function(a){a.init(x)})}var da=a("#snap-coverimagecontrol label");if(da&&da.length){da.keypress(function(b){if(13===b.which){a("#snap-coverfiles").trigger("click")}})}if(!a(".block_settings").length){a("#admin-menu-trigger").hide();if(C){require(["theme_snap/alternative_role_handler-lazy"],function(a){a.init(b.id)})}}var ea=a("ul#snap-navbar-content li:first-child a"),fa=a("#moodle-page a:first"),ga=a("#nav-notification-popover-container > div.popover-region-toggle.nav-link"),ha=a(".search-input-wrapper.nav-link > div[role=\"button\"]"),ia=a("#admin-menu-trigger"),ja;if(ea.length){ja=ea}else{ja=fa}if(ga.length&&ha.length&&ia.length&&ja.length){require(["theme_snap/rearrange_tab_handler-lazy"],function(a){a.init([ga,ha,ia,ja])})}a(".snap-settings-tab-link").on("click",function(){var b=a("a[href=\""+a(this).attr("href")+"\"].nav-link");if(b.length){b.tab("show")}});if("#course-detail-title"===window.location.hash){a("#mr-nav").removeClass("headroom--pinned").addClass("headroom--unpinned")}var ka=a("div[role=main] .mform div.snap-form-required fieldset > div.form-group.fitem"),la=a(window).width();if(767>la){a(".snap-form-advanced").append(ka)}l()});j.snapAxInit();k.init()}}});
//# sourceMappingURL=snap.min.js.map
