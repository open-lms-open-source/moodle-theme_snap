define ("theme_snap/sharing_cart",["exports","jquery"],function(a,b){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=function(a){return a&&a.__esModule?a:{default:a}}(b);function c(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function d(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}a.default=function a(e){var f=this;c(this,a);d(this,"str",function(a){return M.str.block_sharing_cart[a]||M.str.moodle[a]});d(this,"setCreateCommand",function(a){f.create_command=a});d(this,"create_special_activity_command",function(a,c,d){return(0,b.default)("<a href=\"javascript:void(0)\"/>").addClass(a).addClass("dropdown-item menu-action cm-edit-action").attr("title",c).append((0,b.default)("<img class=\"icon\"/>").attr("alt",c).attr("src",d))});d(this,"addSpinner",function(a){if(f.snapSpinner){f.snapSpinner.show()}else{f.snapSpinner=a}});d(this,"hideSpinner",function(){if(f.snapSpinner){f.snapSpinner.hide()}});d(this,"onRestore",function(a){var c=a.restore_targets,d=a.course,e=a.param,g=a.get_action_url,h=a.ModalFactory,i=a.ModalEvents,j=a.id,k=[];f.courseSections.forEach(function(a){var f={directory:c.is_directory,course:d.id,section:a.num,sesskey:M.cfg.sesskey};f[e]=j;var h=g("restore",f),i=null;if(null===a.name){(0,b.default)("#chapters").find(".chapter-title").each(function(){var c=(0,b.default)(this).attr("href");if(c=="#section-"+a.num){i=(0,b.default)(this).text()}})}else{i=a.name}var l={name:i,url:h};k.push(l)});h.create({type:h.types.SAVE_CANCEL,title:M.str.block_sharing_cart.restore,body:function(a){var b=M.str.block_sharing_cart.snap_dialog_restore;b+="<select id=\"select-dialog\" class=\"custom-select\">";for(var c=0;c<a.length;c++){b+="<option value=\""+a[c].url+"\">"+a[c].name+"</option>"}b+="</select> <br> <br>";return b}(k)}).done(function(a){a.show();a.getRoot().on(i.save,function(){window.location.href=(0,b.default)("#select-dialog").val()});a.getRoot().on(i.cancel,function(){a.destroy()})})});d(this,"add_backup_command",function(a,c,d){var e=a.find("ul[role='menu']");if(e.length){var g=e.find("li").first().clone(),h=g.find("a").attr("title",f.str("backup")).attr("href","javascript:void(0)"),i=g.find("img");if(i.length){g.find("img").attr("alt",f.str("backup")).attr("title",f.str("backup")).attr("src",M.util.image_url(c.pix))}else{g.find("i").attr("class","icon fa fa-upload").attr("title",f.str("backup")).attr("aria-label",f.str("backup"))}g.find("span").html(f.str("backup"));e.append(g)}else{var h=f.create_command("backup");e=a.find("div[role=\"menu\"]");if(e.length){var j=c.css,k=f.str("backup"),l=M.util.image_url(c.pix);h=f.create_special_activity_command(j,k,l);if("none"===e.css("display")){var m=e.find(".editing_backup");if(0==m.length){e.append(h.attr("role","menuitem"));h.append((0,b.default)("<span class='menu-action-text'/>").append(h.attr("title")))}}}else{a.find(".commands").append(h)}}var n=a[0].className,o=n.substr(n.indexOf("modtype_")+8),p=f.str("activity_string");if("label"!==o){p=(0,b.default)(".activity#"+a[0].id).find(".activityinstance p.instancename").html()}h.click(function(a){d(a,p)})});d(this,"snapFix",function(a){var c=a.course,d=a.iconBackup,e=a.on_section_backup,g=a.on_backup,h=f;if(c.is_frontpage){if(0<(0,b.default)(".sitetopic li.activity").length){var i=(0,b.default)(".sitetopic li.activity").data("block-sharing-cart");if("done"!==i){(0,b.default)(".sitetopic li.activity").each(function(){h.add_backup_command((0,b.default)(this),d,g)});(0,b.default)(".sitetopic li.activity").data("block-sharing-cart","done")}}if(0<(0,b.default)(".block_site_main_menu").length){var i=(0,b.default)(".block_site_main_menu .content > ul >  li").data("block-sharing-cart");if("done"!==i){(0,b.default)(".block_site_main_menu .content > ul >  li").each(function(){h.add_backup_command((0,b.default)(this),d,g)});(0,b.default)(".block_site_main_menu .content > ul >  li").data("block-sharing-cart","done")}}}else{if(0<(0,b.default)(".course-content li.activity").length){var i=(0,b.default)(".course-content li.activity").data("block-sharing-cart");if("done"!==i||1==f.courseSections.length){(0,b.default)(".course-content li.activity").each(function(){h.add_backup_command((0,b.default)(this),d,g)});(0,b.default)(".course-content li.activity").data("block-sharing-cart","done")}}}if("snap"!==M.cfg.theme){var j=f;(0,b.default)("li.section").each(function(){var a=(0,b.default)(this).find("div.content h3.sectionname span.inplaceeditable").attr("data-itemid"),c=(0,b.default)(this).find("ul[role='menu']").first();if(c.length){var f=c.find("li").first().clone(),g=f.find("img");if(g.length){g.attr("alt",j.str("backup")).attr("title",j.str("backup")).attr("src",M.util.image_url(d.pix,null))}else{f.find("i").attr("class","icon fa fa-upload").attr("title",j.str("backup")).attr("aria-label",j.str("backup"))}f.find("span").html(j.str("backup"));f.find("a").attr("href","javascript:void(0)");c.append(f);f.find("a").click(function(){e(a)})}else{c=(0,b.default)(this).find("div[role='menu']").first();var h=null;if(c.length){var i=d.css,k=j.str("backup"),l=M.util.image_url(d.pix);h=j.create_special_activity_command(i,k,l);c.append(h.attr("role","menuitem"));if("none"===c.css("display")){h.append((0,b.default)("<span class='menu-action-text'/>").append(h.attr("title")))}}else{h=j.create_command("backup");(0,b.default)(this).find(".commands").append(h)}h.click(function(){e(a)})}})}else{b.default.each((0,b.default)("a.snap-delete"),function(a,c){var d=(0,b.default)(c).attr("href").split("?")[1].split("&")[0].split("=")[1],e=(0,b.default)("<a/>").attr("class","snap-sharing-cart").attr("role","button").attr("id",d);e.attr("tabindex","0").attr("title","Backup Section");var f=(0,b.default)(c).parent().find("a.snap-sharing-cart");if(0==f.length){(0,b.default)(c).parent().append(e)}});(0,b.default)("a.snap-sharing-cart").unbind().click(function(){var a=(0,b.default)(this).attr("id"),d=h.courseSections.find(function(b){return b.id===a}),f=d.num,g=c.id,i=null===d.name?void 0:d.name;e(a,f,g,i)})}});this.snapSpinner="";this.courseSections=e};return a.default});
//# sourceMappingURL=sharing_cart.min.js.map
