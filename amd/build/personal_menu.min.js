/**
 * This file is part of Moodle - http://moodle.org/
 *
 * Moodle is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Moodle is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @package
 * @copyright Copyright (c) 2016 Open LMS (https://www.openlms.net)
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_snap/personal_menu",["jquery","core/log","theme_snap/pm_course_cards","theme_snap/util","theme_snap/ajax_notification"],(function($,log,courseCards,util,ajaxNotify){return new function(){var self=this,redirectToSitePolicy=!1,snapFeedsEnabled=!1;this.update=function(){if(redirectToSitePolicy){var redirect=M.cfg.wwwroot+"/user/policy.php";window.location=redirect}else{courseCards.reqCourseInfo(courseCards.getCourseIds()),$("#snap-pm").focus();var loadAjaxInfo=function(type){var container=$("#snap-personal-menu-"+type);if($(container).length){var cacheKey=M.cfg.sesskey+"personal-menu-"+type;try{if(util.supportsSessionStorage()&&window.sessionStorage[cacheKey]){log.info("using locally stored "+type);var html=window.sessionStorage[cacheKey];$(container).html(html)}log.info("fetching "+type),$.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_"+type+"&contextid="+M.cfg.context,success:function(data){ajaxNotify.ifErrorShowBestMsg(data).done((function(errorShown){errorShown||(log.info("fetched "+type),util.supportsSessionStorage()&&void 0!==data.html&&(window.sessionStorage[cacheKey]=data.html),$(container).attr("data-content-loaded","1"),$(container).html(data.html))}))}})}catch(err){sessionStorage.clear(),log.error(err)}}};if(!snapFeedsEnabled){loadAjaxInfo("deadlines"),loadAjaxInfo("graded"),loadAjaxInfo("grading"),loadAjaxInfo("messages"),loadAjaxInfo("forumposts"),$(document).trigger("snapUpdatePersonalMenu");try{document.dispatchEvent(new Event("snapPersonalMenuOpen"))}catch(error){log.error(error.message);try{var evt=document.createEvent("Event");evt.initEvent("snapPersonalMenuOpen",!0,!0),document.dispatchEvent(evt)}catch(err){log.error(err.message)}}}}};var applyListeners=function(){var getSectionCoords;$(document).on("click",".js-snap-pm-trigger",(function(event){if($("html, body").animate({scrollTop:0},0),$("body").toggleClass("snap-pm-open"),$(".snap-pm-open #snap-pm").is(":visible")&&self.update(),event.preventDefault(),window.innerWidth<992){if($("#snap-pm-updates div#snap-personal-menu-intelliboard").length>0)$("#snap-pm div#snap-personal-menu-intelliboard").closest("section").appendTo("section#snap-pm-courses");if($("#snap-pm-updates div#snap-personal-menu-intellicart").length>0)$("#snap-pm div#snap-personal-menu-intellicart").closest("section").appendTo("section#snap-pm-courses")}0===$(".message-app.main").length&&document.dispatchEvent(new Event("messages-drawer:pm-toggle"))})),getSectionCoords=function(href){var sections=$("#snap-pm-content section"),sectionWidth=$(sections).outerWidth(),section=$(href),position=sectionWidth*($("#snap-pm-updates section > div, #snap-pm-updates section > snap-feed > div").index(section)+1),sectionHeight=$(href).outerHeight()+200;"#snap-pm-courses"==href&&(position=0);var winHeight=$(window).height();return sectionHeight<winHeight&&(sectionHeight=winHeight),{left:position,height:sectionHeight}},$(window).on("resize",(function(){if(window.innerWidth>=992)$("#snap-pm-content").removeAttr("style"),$("#snap-pm-courses div#snap-personal-menu-intelliboard").length>0&&$("#snap-pm div#snap-personal-menu-intelliboard").closest("section").prependTo("#snap-pm-updates"),$("#snap-pm-courses div#snap-personal-menu-intellicart").length>0&&$("#snap-pm div#snap-personal-menu-intellicart").closest("section").prependTo("#snap-pm-updates");else{var activeLink=$("#snap-pm-mobilemenu a.state-active");if(activeLink&&activeLink.length){$("#snap-pm-updates div#snap-personal-menu-intelliboard").length>0&&$("#snap-pm div#snap-personal-menu-intelliboard").closest("section").appendTo("section#snap-pm-courses"),$("#snap-pm-updates div#snap-personal-menu-intellicart").length>0&&$("#snap-pm div#snap-personal-menu-intellicart").closest("section").appendTo("section#snap-pm-courses");var href=activeLink.attr("href"),posHeight=getSectionCoords(href);$("#snap-pm-content").css("left","-"+posHeight.left+"px"),$("#snap-pm-content").css("height",posHeight.height+"px")}}})),$(document).on("click","#snap-pm-mobilemenu a",(function(e){var href=this.getAttribute("href"),posHeight=getSectionCoords(href);$("html, body").animate({scrollTop:0},0),$("#snap-pm-content").animate({left:"-"+posHeight.left+"px",height:posHeight.height+"px"},"700","swing",(function(){})),$("#snap-pm-mobilemenu a").removeClass("state-active"),$(this).addClass("state-active"),e.preventDefault()}))};this.init=function(sitePolicyAcceptReqd,snapFeedsFlag){redirectToSitePolicy=sitePolicyAcceptReqd,snapFeedsEnabled=snapFeedsFlag,applyListeners(),redirectToSitePolicy||courseCards.init()}}}));

//# sourceMappingURL=personal_menu.min.js.map