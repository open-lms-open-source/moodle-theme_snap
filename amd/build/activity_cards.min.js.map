{"version":3,"file":"activity_cards.min.js","sources":["../src/activity_cards.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package\n * @copyright Copyright (c) 2025 Open LMS (https://www.openlms.net)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n    'use strict';\n\n    var initialized = false;\n\n    /**\n     * Determines if an item is a Snap resource card.\n     * @param {HTMLElement} item\n     * @returns {boolean} True if the item should be treated as a resource card.\n     */\n    var isSnapResourceCard = function(item) {\n        if (item.classList.contains('modtype_resource')) {\n            return !item.querySelector('.snap-resource-figure');\n        } else if (item.classList.contains('modtype_folder')) {\n            return !!item.querySelector('.activity-name-area');\n        } else if (\n            item.classList.contains('modtype_url') ||\n            item.classList.contains('modtype_imscp') ||\n            item.classList.contains('modtype_lightboxgallery') ||\n            item.classList.contains('modtype_scorm')\n        ) {\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Initializes the single-click behavior of Snap dropdown menus.\n     */\n    var initResourceCardDropdownBehavior = function() {\n        const body = document.body;\n\n        if (!body.classList.contains('snap-resource-card') ||\n            !(body.classList.contains('format-weeks') || body.classList.contains('format-topics')) ||\n            document.querySelector('.moodle-dialogue-base') ||\n            document.querySelector('.modal-dialog')) {\n            return;\n        }\n\n        const courseContent = document.querySelector('.course-content');\n        if (!courseContent) {\n            return;\n        }\n\n        const BREAKPOINT_MIN = 600;\n        const containerWidth = courseContent.offsetWidth;\n        if (containerWidth < BREAKPOINT_MIN) {\n            return;\n        }\n\n        // Only initialize listeners once to avoid duplicates.\n        if (initialized) {\n            return;\n        }\n        initialized = true;\n\n        const setMenuState = function(menu, open) {\n            menu.classList.toggle('show', open);\n            menu.setAttribute('aria-hidden', String(!open));\n            menu.dataset.open = open ? 'true' : 'false';\n            const parent = menu.closest('.dropdown-subpanel');\n            if (parent) {\n                parent.classList.toggle('content-displayed', open);\n            }\n        };\n\n        const closeMenu = function(menu) {\n            setMenuState(menu, false);\n        };\n\n        const openMenu = function(menu) {\n            setMenuState(menu, true);\n        };\n\n        const closeAllMenusInWrapper = function(wrapper, exceptMenu) {\n            wrapper.querySelectorAll('.dropdown-subpanel-content').forEach(function(menu) {\n                if (menu !== exceptMenu) {\n                    closeMenu(menu);\n                }\n            });\n        };\n\n        const closeAllMenus = function() {\n            document.querySelectorAll('.dropdown-subpanel-content[data-open=\"true\"]').forEach(closeMenu);\n        };\n\n        // Disable the hover\n        courseContent.addEventListener('mouseover', function(e) {\n            const trigger = e.target.closest('.dropdown-subpanel > .dropdown-item');\n            if (!trigger) {\n                return;\n            }\n            const wrapper = trigger.closest('li.activity-wrapper');\n            if (wrapper && isSnapResourceCard(wrapper)) {\n                e.stopImmediatePropagation();\n            }\n        }, true);\n\n        // Handle click toggle\n        courseContent.addEventListener('click', function(e) {\n            const toggle = e.target.closest('[data-toggle=\"dropdown-subpanel\"]');\n            if (!toggle) {\n                return;\n            }\n\n            const wrapper = toggle.closest('li.activity-wrapper');\n            if (!wrapper || !isSnapResourceCard(wrapper)) {\n                return;\n            }\n\n            const subpanel = toggle.closest('.dropdown-subpanel');\n            const menu = subpanel && subpanel.querySelector('.dropdown-subpanel-content');\n            if (!menu) {\n                return;\n            }\n\n            e.preventDefault();\n            e.stopPropagation();\n            e.stopImmediatePropagation();\n\n            const isOpen = menu.dataset.open === 'true';\n            closeAllMenusInWrapper(wrapper, menu);\n            if (isOpen) {\n                closeMenu(menu);\n            } else {\n                openMenu(menu);\n            }\n        }, true);\n\n        // Close menus when clicking outside\n        courseContent.addEventListener('click', function(e) {\n            if (e.target.closest('.dropdown-subpanel')) {\n                return;\n            }\n            const openMenus = document.querySelectorAll('.dropdown-subpanel-content[data-open=\"true\"]');\n            if (openMenus.length === 0) {\n                return;\n            }\n            closeAllMenus();\n        }, true);\n    };\n\n    return {\n        /**\n         * Initialize activity cards behavior.\n         */\n        init: function() {\n            initResourceCardDropdownBehavior();\n        }\n    };\n});"],"names":["define","initialized","isSnapResourceCard","item","classList","contains","querySelector","initResourceCardDropdownBehavior","body","document","courseContent","offsetWidth","setMenuState","menu","open","toggle","setAttribute","String","dataset","parent","closest","closeMenu","addEventListener","e","trigger","target","wrapper","stopImmediatePropagation","subpanel","preventDefault","stopPropagation","isOpen","exceptMenu","querySelectorAll","forEach","closeAllMenusInWrapper","openMenu","length","init"],"mappings":";;;;;;;;;;;;;;;;;;;;AAqBAA,mCAAO,IAAI,eAGHC,aAAc,EAOdC,mBAAqB,SAASC,aAC1BA,KAAKC,UAAUC,SAAS,qBAChBF,KAAKG,cAAc,yBACpBH,KAAKC,UAAUC,SAAS,oBACtBF,KAAKG,cAAc,0BAE5BH,KAAKC,UAAUC,SAAS,gBACxBF,KAAKC,UAAUC,SAAS,kBACxBF,KAAKC,UAAUC,SAAS,4BACxBF,KAAKC,UAAUC,SAAS,mBAU5BE,iCAAmC,iBAC7BC,KAAOC,SAASD,SAEjBA,KAAKJ,UAAUC,SAAS,wBACvBG,KAAKJ,UAAUC,SAAS,kBAAmBG,KAAKJ,UAAUC,SAAS,kBACrEI,SAASH,cAAc,0BACvBG,SAASH,cAAc,8BAIrBI,cAAgBD,SAASH,cAAc,uBACxCI,wBAKkBA,cAAcC,YADd,cAOnBV,mBAGJA,aAAc,QAERW,aAAe,SAASC,KAAMC,MAChCD,KAAKT,UAAUW,OAAO,OAAQD,MAC9BD,KAAKG,aAAa,cAAeC,QAAQH,OACzCD,KAAKK,QAAQJ,KAAOA,KAAO,OAAS,cAC9BK,OAASN,KAAKO,QAAQ,sBACxBD,QACAA,OAAOf,UAAUW,OAAO,oBAAqBD,OAI/CO,UAAY,SAASR,MACvBD,aAAaC,MAAM,IAoBvBH,cAAcY,iBAAiB,aAAa,SAASC,SAC3CC,QAAUD,EAAEE,OAAOL,QAAQ,2CAC5BI,qBAGCE,QAAUF,QAAQJ,QAAQ,uBAC5BM,SAAWxB,mBAAmBwB,UAC9BH,EAAEI,8BAEP,GAGHjB,cAAcY,iBAAiB,SAAS,SAASC,SACvCR,OAASQ,EAAEE,OAAOL,QAAQ,yCAC3BL,oBAICW,QAAUX,OAAOK,QAAQ,2BAC1BM,UAAYxB,mBAAmBwB,sBAI9BE,SAAWb,OAAOK,QAAQ,sBAC1BP,KAAOe,UAAYA,SAAStB,cAAc,kCAC3CO,YAILU,EAAEM,iBACFN,EAAEO,kBACFP,EAAEI,iCAEII,OAA+B,SAAtBlB,KAAKK,QAAQJ,MA9CD,SAASY,QAASM,YAC7CN,QAAQO,iBAAiB,8BAA8BC,SAAQ,SAASrB,MAChEA,OAASmB,YACTX,UAAUR,SA4ClBsB,CAAuBT,QAASb,MAC5BkB,OACAV,UAAUR,MArDD,SAASA,MACtBD,aAAaC,MAAM,GAsDfuB,CAASvB,SAEd,GAGHH,cAAcY,iBAAiB,SAAS,SAASC,MACzCA,EAAEE,OAAOL,QAAQ,6BAII,IADPX,SAASwB,iBAAiB,gDAC9BI,QApDd5B,SAASwB,iBAAiB,gDAAgDC,QAAQb,cAwDnF,UAGA,CAIHiB,KAAM,WACF/B"}