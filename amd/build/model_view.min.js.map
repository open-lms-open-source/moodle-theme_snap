{"version":3,"sources":["../src/model_view.js"],"names":["define","$","notification","templates","log","element","templateName","model","cloneAttributes","src","target","skipid","srcKeys","each","attributes","name","push","attr","value","indexOf","removeAttr","updateModel","newModel","callback","debug","data","m","render","done","result","tempEl","parseHTML","html","trigger","fail","exception","init","on","event"],"mappings":"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","sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package   theme_snap\n * @copyright Copyright (c) 2016 Blackboard Inc. (http://www.blackboard.com)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Model view handling.\n */\ndefine(['jquery', 'core/notification', 'core/templates', 'core/log'], function($, notification, templates, log) {\n    return function(element, templateName, model) {\n\n        /**\n         * Make the target's attributes identical to the sources.\n         * @param {jQuery} src\n         * @param {jQuery} target\n         * @param {bool} skipid\n         */\n        var cloneAttributes = function(src, target, skipid) {\n            var srcKeys = [];\n            $.each($(src)[0].attributes, function() {\n                if (this.name == 'data-model') {\n                    return true;\n                }\n                if (skipid && this.name == 'id') {\n                    return true;\n                }\n                srcKeys.push(this.name);\n                $(target).attr(this.name, this.value);\n                return true;\n            });\n            $.each($(target)[0].attributes, function() {\n                if (srcKeys.indexOf(this.name) == -1) {\n                    $(target).removeAttr(this.name);\n                }\n            });\n        };\n\n        /**\n         * Update element with new model.\n         * @param {null|object} newModel\n         * @param {null|function} callback\n         */\n        var updateModel = function(newModel, callback) {\n            if (!newModel) {\n                log.debug('Using data element for model');\n                newModel = $(element).data('model');\n            } else {\n                log.debug('Using object for model');\n            }\n\n            // Update model.\n            for (var m in newModel) {\n                model[m] = newModel[m];\n            }\n\n            $(element).data('model', model);\n\n            // Update element.\n            templates.render(templateName, model)\n                .done(function(result) {\n                    // Using replaceWith can be jerky as you are taking the element out of the dom instead of replacing\n                    // its content. So instead of $(cardEl).replaceWith(result); we parse the html from the template and\n                    // update the html of the card.\n                    var tempEl = $($.parseHTML(result));\n                    $(element).html(tempEl.html());\n                    cloneAttributes(tempEl, $(element), true);\n                    if (typeof (callback) === 'function') {\n                        callback();\n                    }\n                    $(element).trigger('modelUpdated');\n                }).fail(notification.exception);\n        };\n\n        /**\n         * Main initialising function - create custom modelUpdate function on element.\n         */\n        var init = function() {\n            if (!model && $(element).data('model')) {\n                model = $(element).data('model');\n            }\n            if ($(element).data('modelInitialised') != 1) {\n                $(element).on(\"modelUpdate\", function(event, newModel, callback) {\n                    updateModel(newModel, callback);\n                });\n            }\n            $(element).data('modelInitialised', 1);\n        };\n\n        init();\n    };\n});\n"],"file":"model_view.min.js"}