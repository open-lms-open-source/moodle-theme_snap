{"version":3,"file":"blocks_drawer.min.js","sources":["../src/blocks_drawer.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Blocks drawer module.\n * Drawer related logic.\n *\n * @module     theme_snap/blocks_drawer\n * @copyright  2025 Copyright (c) 2024 Open LMS (https://www.openlms.net)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Drawers from 'theme_boost/drawers';\n\nconst SELECTORS = {\n    ADMIN_MENU_TRIGGER: 'admin-menu-trigger',\n    DRAWER_OPEN_BUTTON: '.drawer-toggler.drawer-right-toggle > button',\n    SNAP_FEEDS_TRIGGER: 'snap_feeds_side_menu_trigger',\n    BLOCK_SETTINGS: '.block_settings',\n    DRAWER: '.drawer',\n};\n\n/**\n * Setup event listeners.\n */\nconst setupEventListeners = () => {\n    const adminMenuTrigger = document.getElementById(SELECTORS.ADMIN_MENU_TRIGGER);\n    const snapFeedsTrigger = document.getElementById(SELECTORS.SNAP_FEEDS_TRIGGER);\n    if (adminMenuTrigger) {\n        adminMenuTrigger.addEventListener('click', () => {\n            Drawers.closeAllDrawers();\n            setTimeout(() => {\n                if (adminMenuTrigger.classList.contains('active')) {\n                    hideDrawerOpenButton();\n                } else {\n                    showDrawerOpenButton();\n                }\n            }, 200); // 200ms delay to allow the drawer to animate.\n        });\n    }\n    if (snapFeedsTrigger) {\n        snapFeedsTrigger.addEventListener('click', () => {\n            Drawers.closeAllDrawers();\n            setTimeout(() => {\n                if (snapFeedsTrigger.getAttribute('aria-expanded') === 'true') {\n                    hideDrawerOpenButton();\n                } else {\n                    showDrawerOpenButton();\n                }\n            }, 200); // 200ms delay to allow the drawer to animate.\n        });\n    }\n    document.addEventListener(Drawers.eventTypes.drawerShow, e => {\n        const originalPreventOverlap = e.detail.drawerInstance.preventOverlap;\n        e.detail.drawerInstance.preventOverlap = () => {\n            if (document.querySelector(SELECTORS.DRAWER_OPEN_BUTTON) != document.activeElement) {\n                originalPreventOverlap.call(document.activeElement);\n            }\n        };\n    }, true);\n    document.addEventListener('focusin', (e) => {\n        if (document.querySelector(SELECTORS.DRAWER).contains(document.activeElement) ||\n            document.activeElement.tagName === 'BODY' ||\n            document.activeElement.tagName === 'BUTTON') {\n            e.stopPropagation();\n        }\n    }, true);\n    document.addEventListener('focusout', (e) => {\n        if (document.querySelector(SELECTORS.DRAWER).contains(document.activeElement) ||\n            document.activeElement.tagName === 'BODY' ||\n            document.activeElement.tagName === 'BUTTON') {\n            e.stopPropagation();\n        }\n    }, true);\n};\n\n/**\n * Show the drawer open button.\n */\nconst showDrawerOpenButton = () => {\n    const drawerOpenButton = document.querySelector(SELECTORS.DRAWER_OPEN_BUTTON);\n    if (drawerOpenButton) {\n        drawerOpenButton.style.display = 'inline-block';\n    }\n};\n\n/**\n * Hide the drawer open button.\n */\nconst hideDrawerOpenButton = () => {\n    const drawerOpenButton = document.querySelector(SELECTORS.DRAWER_OPEN_BUTTON);\n    if (drawerOpenButton) {\n        drawerOpenButton.style.display = 'none';\n    }\n};\n\n/**\n * Reposition the settings block above the drawer.\n * Note: This is because the settings block is handled outside the drawer.\n */\nconst repositionSettingsBlock = () => {\n    const settingsBlock = document.querySelector(SELECTORS.BLOCK_SETTINGS);\n    if (settingsBlock) {\n        settingsBlock.parentNode.removeChild(settingsBlock);\n        const drawer = document.querySelector(SELECTORS.DRAWER);\n        drawer.parentNode.insertBefore(settingsBlock, drawer);\n    }\n};\n\nexport const init = () => {\n    setupEventListeners();\n    repositionSettingsBlock();\n};\n"],"names":["SELECTORS","showDrawerOpenButton","drawerOpenButton","document","querySelector","style","display","hideDrawerOpenButton","adminMenuTrigger","getElementById","snapFeedsTrigger","addEventListener","closeAllDrawers","setTimeout","classList","contains","getAttribute","Drawers","eventTypes","drawerShow","e","originalPreventOverlap","detail","drawerInstance","preventOverlap","activeElement","call","tagName","stopPropagation","setupEventListeners","settingsBlock","parentNode","removeChild","drawer","insertBefore","repositionSettingsBlock"],"mappings":";;;;;;;;kJA0BMA,6BACkB,qBADlBA,6BAEkB,+CAFlBA,6BAGkB,+BAHlBA,yBAIc,kBAJdA,iBAKM,UA4DNC,qBAAuB,WACnBC,iBAAmBC,SAASC,cAAcJ,8BAC5CE,mBACAA,iBAAiBG,MAAMC,QAAU,iBAOnCC,qBAAuB,WACnBL,iBAAmBC,SAASC,cAAcJ,8BAC5CE,mBACAA,iBAAiBG,MAAMC,QAAU,uBAiBrB,KApFQ,YAClBE,iBAAmBL,SAASM,eAAeT,8BAC3CU,iBAAmBP,SAASM,eAAeT,8BAC7CQ,kBACAA,iBAAiBG,iBAAiB,SAAS,sBAC/BC,kBACRC,YAAW,KACHL,iBAAiBM,UAAUC,SAAS,UACpCR,uBAEAN,yBAEL,QAGPS,kBACAA,iBAAiBC,iBAAiB,SAAS,sBAC/BC,kBACRC,YAAW,KACgD,SAAnDH,iBAAiBM,aAAa,iBAC9BT,uBAEAN,yBAEL,QAGXE,SAASQ,iBAAiBM,iBAAQC,WAAWC,YAAYC,UAC/CC,uBAAyBD,EAAEE,OAAOC,eAAeC,eACvDJ,EAAEE,OAAOC,eAAeC,eAAiB,KACjCrB,SAASC,cAAcJ,+BAAiCG,SAASsB,eACjEJ,uBAAuBK,KAAKvB,SAASsB,mBAG9C,GACHtB,SAASQ,iBAAiB,WAAYS,KAC9BjB,SAASC,cAAcJ,kBAAkBe,SAASZ,SAASsB,gBACxB,SAAnCtB,SAASsB,cAAcE,SACY,WAAnCxB,SAASsB,cAAcE,UACvBP,EAAEQ,qBAEP,GACHzB,SAASQ,iBAAiB,YAAaS,KAC/BjB,SAASC,cAAcJ,kBAAkBe,SAASZ,SAASsB,gBACxB,SAAnCtB,SAASsB,cAAcE,SACY,WAAnCxB,SAASsB,cAAcE,UACvBP,EAAEQ,qBAEP,IAqCHC,GAV4B,YACtBC,cAAgB3B,SAASC,cAAcJ,6BACzC8B,cAAe,CACfA,cAAcC,WAAWC,YAAYF,qBAC/BG,OAAS9B,SAASC,cAAcJ,kBACtCiC,OAAOF,WAAWG,aAAaJ,cAAeG,UAMlDE"}