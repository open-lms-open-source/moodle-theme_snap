define(["jquery","core/notification","core/templates","core/log"],function(a,b,c,d){return function(e,f,g){var h=function(b,c,d){var e=[];a.each(a(b)[0].attributes,function(){return"data-model"==this.name||(!(!d||"id"!=this.name)||(e.push(this.name),a(c).attr(this.name,this.value),!0))}),a.each(a(c)[0].attributes,function(){e.indexOf(this.name)==-1&&a(c).removeAttr(this.name)})},i=function(i,j){i?d.debug("Using object for model"):(d.debug("Using data element for model"),i=a(e).data("model"));for(var k in i)g[k]=i[k];a(e).data("model",g),c.render(f,g).done(function(b){var c=a(a.parseHTML(b));a(e).html(c.html()),h(c,a(e),!0),"function"==typeof j&&j(),a(e).trigger("modelUpdated")}).fail(b.exception)},j=function(){!g&&a(e).data("model")&&(g=a(e).data("model")),1!=a(e).data("modelInitialised")&&a(e).on("modelUpdate",function(a,b,c){i(b,c)}),a(e).data("modelInitialised",1)};j()}});