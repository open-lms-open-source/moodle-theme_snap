{"version":3,"file":"course_modules.min.js","sources":["../src/course_modules.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package\n * @author    Guy Thomas\n * @copyright Copyright (c) 2016 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Course main functions.\n */\ndefine(\n    [\n        'jquery',\n        'core/ajax',\n        'theme_snap/util',\n        'theme_snap/ajax_notification',\n        'core/str',\n        'core/event'\n    ],\n    function($, ajax, util, ajaxNotify, str, Event) {\n\n        /**\n         * Reveal page module content.\n         *\n         * @param {jQuery} pageMod\n         */\n        var revealPageMod = function(pageMod) {\n            pageMod.find('.pagemod-content').slideToggle(\"fast\", function() {\n                // Animation complete.\n                if (pageMod.is('.state-expanded')) {\n                    pageMod.attr('aria-expanded', 'true');\n                    pageMod.find('.pagemod-content').focus();\n\n                } else {\n                    pageMod.attr('aria-expanded', 'false');\n                    pageMod.focus();\n                }\n\n            });\n        };\n\n        /**\n         * Page mod toggle content.\n         */\n        var listenPageModuleReadMore = function() {\n            var pageToggleSelector = \".pagemod-readmore,.pagemod-content .snap-action-icon\";\n            $(document).on(\"click\", pageToggleSelector, function(e) {\n                var pageMod = $(this).closest('.modtype_page');\n                util.scrollToElement(pageMod);\n                var isexpanded = pageMod.hasClass('state-expanded');\n                pageMod.toggleClass('state-expanded');\n\n                var readmore = pageMod.find('.pagemod-readmore');\n\n                var pageModContent = pageMod.find('.pagemod-content');\n                if (pageModContent.data('content-loaded') == 1) {\n                    // Content is already available so reveal it immediately.\n                    revealPageMod(pageMod);\n                    var readPageUrl = M.cfg.wwwroot + '/theme/snap/rest.php?action=read_page&contextid=' +\n                        readmore.data('pagemodcontext');\n                    if (!isexpanded) {\n                        $.ajax({\n                            type: \"GET\",\n                            async: true,\n                            url: readPageUrl,\n                            success: function(data) {\n                                ajaxNotify.ifErrorShowBestMsg(data).done(function(errorShown) {\n                                    if (errorShown) {\n                                        return;\n                                    }\n                                });\n                            }\n                        });\n                    }\n                } else {\n                    if (!isexpanded) {\n                        // Content is not available so request it.\n                        var loadingStrPromise = str.get_string('loading', 'theme_snap');\n                        $.when(loadingStrPromise).done(function(loadingStr) {\n                            pageMod.find('.contentafterlink').prepend(\n                                '<div class=\"ajaxstatus alert alert-info\">' + loadingStr + '</div>'\n                            );\n                        });\n                        var getPageUrl = M.cfg.wwwroot + '/theme/snap/rest.php?action=get_page&contextid=' +\n                            readmore.data('pagemodcontext');\n                        $.ajax({\n                            type: \"GET\",\n                            async: true,\n                            url: getPageUrl,\n                            success: function(data) {\n                                ajaxNotify.ifErrorShowBestMsg(data).done(function(errorShown) {\n                                    if (errorShown) {\n                                        return;\n                                    } else {\n                                        // No errors, reveal page mod.\n                                        pageModContent.find('#pagemod-content-container').prepend(data.html);\n                                        pageModContent.data('content-loaded', 1);\n                                        pageMod.find('.contentafterlink .ajaxstatus').remove();\n                                        revealPageMod(pageMod);\n                                        Event.notifyFilterContentUpdated('.pagemod-content');\n                                    }\n                                });\n                            }\n                        }).then(\n                            ()=>{\n                                $(document).trigger('snap-course-content-loaded');\n                            }\n                        );\n                    } else {\n                        revealPageMod(pageMod);\n                    }\n                }\n\n                e.preventDefault();\n            });\n        };\n\n        return {\n\n            init: function() {\n\n                // Listeners.\n                listenPageModuleReadMore();\n            }\n        };\n    }\n);\n"],"names":["define","$","ajax","util","ajaxNotify","str","Event","revealPageMod","pageMod","find","slideToggle","is","attr","focus","init","document","on","e","this","closest","scrollToElement","isexpanded","hasClass","toggleClass","readmore","pageModContent","data","readPageUrl","M","cfg","wwwroot","type","async","url","success","ifErrorShowBestMsg","done","errorShown","loadingStrPromise","get_string","when","loadingStr","prepend","getPageUrl","html","remove","notifyFilterContentUpdated","then","trigger","preventDefault"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAyBAA,mCACI,CACI,SACA,YACA,kBACA,+BACA,WACA,eAEJ,SAASC,EAAGC,KAAMC,KAAMC,WAAYC,IAAKC,WAOjCC,cAAgB,SAASC,SACzBA,QAAQC,KAAK,oBAAoBC,YAAY,QAAQ,WAE7CF,QAAQG,GAAG,oBACXH,QAAQI,KAAK,gBAAiB,QAC9BJ,QAAQC,KAAK,oBAAoBI,UAGjCL,QAAQI,KAAK,gBAAiB,SAC9BJ,QAAQK,mBAkFb,CAEHC,KAAM,WAzENb,EAAEc,UAAUC,GAAG,QADU,wDACmB,SAASC,OAC7CT,QAAUP,EAAEiB,MAAMC,QAAQ,iBAC9BhB,KAAKiB,gBAAgBZ,aACjBa,WAAab,QAAQc,SAAS,kBAClCd,QAAQe,YAAY,sBAEhBC,SAAWhB,QAAQC,KAAK,qBAExBgB,eAAiBjB,QAAQC,KAAK,uBACW,GAAzCgB,eAAeC,KAAK,kBAAwB,CAE5CnB,cAAcC,aACVmB,YAAcC,EAAEC,IAAIC,QAAU,mDAC9BN,SAASE,KAAK,kBACbL,YACDpB,EAAEC,KAAK,CACH6B,KAAM,MACNC,OAAO,EACPC,IAAKN,YACLO,QAAS,SAASR,MACdtB,WAAW+B,mBAAmBT,MAAMU,MAAK,SAASC,2BASzDhB,WAkCDd,cAAcC,aAlCD,KAET8B,kBAAoBjC,IAAIkC,WAAW,UAAW,cAClDtC,EAAEuC,KAAKF,mBAAmBF,MAAK,SAASK,YACpCjC,QAAQC,KAAK,qBAAqBiC,QAC9B,4CAA8CD,WAAa,iBAG/DE,WAAaf,EAAEC,IAAIC,QAAU,kDAC7BN,SAASE,KAAK,kBAClBzB,EAAEC,KAAK,CACH6B,KAAM,MACNC,OAAO,EACPC,IAAKU,WACLT,QAAS,SAASR,MACdtB,WAAW+B,mBAAmBT,MAAMU,MAAK,SAASC,YAC1CA,aAIAZ,eAAehB,KAAK,8BAA8BiC,QAAQhB,KAAKkB,MAC/DnB,eAAeC,KAAK,iBAAkB,GACtClB,QAAQC,KAAK,iCAAiCoC,SAC9CtC,cAAcC,SACdF,MAAMwC,2BAA2B,2BAI9CC,MACC,KACI9C,EAAEc,UAAUiC,QAAQ,iCAQpC/B,EAAEgC"}