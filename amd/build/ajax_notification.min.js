function _typeof(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("theme_snap/ajax_notification",["jquery","core/notification","core/ajax","core/templates","core/str","theme_snap/util"],function(a,b,c,d,e,f){var g=!1,h=!1,i=!1;a(document).ready(function(){a("#snap-pm-logout").click(function(){h=!0})});return{ifErrorShowBestMsg:function ifErrorShowBestMsg(c,j,k){var l=a.Deferred(),m=function(c){var d=a.Deferred();if(k){b.alert(M.util.get_string("error","moodle"),k,M.util.get_string("ok","moodle"))}else{if(c.backtrace){b.exception(c)}else{var e;if(c.error){e=c.error;if(c.stacktrace){e="<div>"+e+"<pre>"+c.stacktrace+"</pre></div>"}}else{if(c.errorcode&&c.message){e=c.message}else{d.resolve(!1);return d.promise()}}b.alert(M.util.get_string("error","moodle"),e,M.util.get_string("ok","moodle"))}}f.whenTrue(function(){var b=a(".moodle-dialogue-base").is(":visible");return b},function(){d.resolve(!0)},!0);return d.promise()};if(g){l.resolve(!0);return l.promise()}if(h){l.resolve(!0);return l.promise()}if("object"!==_typeof(c)){try{var n=JSON.parse(c);c=n}catch(a){}}if("undefined"==typeof c){return!1}if(c.errorcode&&"sitepolicynotagreed"===c.errorcode){var o=M.cfg.wwwroot+"/user/policy.php";if(window.location!=o&&!i&&a("#primary-nav").is(":visible")){window.location=o;i=!0;g=!0;l.resolve(!0)}else{l.resolve(!1)}return l.promise()}if(c.error||c.errorcode){if(M.snapTheme.forcePassChange){var p=M.cfg.wwwroot+"/login/change_password.php";if(a("#snap-pm-content").length){e.get_string("forcepwdwarningpersonalmenu","theme_snap",p).then(function(a){return d.render("core/notification_warning",{message:a,extraclasses:"force-pwd-warning"})}).then(function(b){a("#snap-pm-content").html("<br />"+b);l.resolve(!0)});if(a("#snap-pm-content").is(":visible")){g=!0;return l.promise()}}if(window.location!=p){window.location=p}g=!0;l.resolve(!0);return l.promise()}j=j?j:"";return a.ajax({type:"POST",async:!0,data:{sesskey:M.cfg.sesskey,failedactionmsg:j},url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_loginstatus"}).then(function(d){if(g){l.resolve(!0);return l.promise()}if(!d.loggedin){a("<style>.confirmation-dialogue .confirmation-buttons input:nth-of-type(2), .moodle-dialogue-base.moodle-dialogue-confirm button.yui3-button.closebutton{ display : none }</style>").appendTo("head");b.confirm(d.loggedouttitle,d.loggedoutmsg,d.loggedoutcontinue," ",function(){window.location=M.cfg.wwwroot+"/login/index.php"});g=!0;l.resolve(!0);return l.promise()}else{return m(c)}})}l.resolve(!1);return l.promise()}}});
//# sourceMappingURL=ajax_notification.min.js.map
