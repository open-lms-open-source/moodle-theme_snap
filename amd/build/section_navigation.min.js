define("theme_snap/section_navigation",["exports","core_courseformat/local/content","core_courseformat/courseeditor"],(function(_exports,_content,_courseeditor){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_content=(obj=_content)&&obj.__esModule?obj:{default:obj};class SectionNavigation extends _content.default{create(descriptor){super.create(descriptor),this.sectionId=descriptor.sectionId,this.navigationButtons={previous:null,next:null},this.selectors={SECTION:'.course-content ul.sections > li[data-id="'.concat(this.sectionId,'"]'),PREVIOUS:".section_footer .previous_section",NEXT:".section_footer .next_section",TITLE:".nav_title",ICON:"i[section-number]"},this.classes={DISABLED:"disabled"},this.attributes={SECTION_NUMBER:"section-number"}}stateReady(state){this.section=state.section.get(this.sectionId)}static init(target,sectionId){const element=document.querySelector(target);if(!element)return null;let instance=null;return SectionNavigation.instances.has(sectionId)?instance=SectionNavigation.instances.get(sectionId):(instance=new this({element:element,reactive:(0,_courseeditor.getCurrentCourseEditor)(),sectionId:sectionId}),SectionNavigation.instances.set(sectionId,instance)),instance}getWatchers(){return[{watch:"course.sectionlist:updated",handler:this._sectionNavigationUpdate},{watch:"section.cmlist:updated",handler:this._subsectionNavigationUpdate}]}_subsectionNavigationUpdate(_ref){let{element:element}=_ref;if(!this.reactive.isEditing)return;const currentSectionId=this.sectionId,parentsectionid=this.reactive.state.section.get(currentSectionId).parentsectionid;if(null===parentsectionid)return;const sectionsMap=new Map([...this.reactive.state.section].filter((_ref2=>{let[,value]=_ref2;return null!==value.component&&value.parentsectionid==parentsectionid})));let subsectionMap=this._getCmToSubsectionMapBySectionId(element);const sections=element.cmlist.filter((cmid=>subsectionMap.has(cmid))).map((cmid=>subsectionMap.get(cmid)));this._updateNavigation(sections,sectionsMap,currentSectionId)}_sectionNavigationUpdate(_ref3){let{element:element}=_ref3;if(!this.reactive.isEditing)return;const currentSectionId=this.sectionId;if(null!==this.reactive.state.section.get(currentSectionId).component)return;const sectionsMap=new Map([...this.reactive.state.section].filter((_ref4=>{let[,value]=_ref4;return null===value.component})));this._updateNavigation(element.sectionlist,sectionsMap,currentSectionId)}_updateNavigation(sections,sectionsMap,currentSectionId){const{previous:previous,next:next}=this._getNextAndPrevious(sections,sectionsMap,currentSectionId);this.navigationButtons={previous:previous,next:next},this.renderNavigationButtons()}_getNextAndPrevious(sections,sectionsMap,currentSection){const index=sections.indexOf(String(currentSection));if(-1===index)return{previous:null,next:null};const previousId=index>0?sections[index-1]:null,nextId=index<sections.length-1?sections[index+1]:null;return{previous:previousId&&sectionsMap.has(previousId)?sectionsMap.get(previousId):null,next:nextId&&sectionsMap.has(nextId)?sectionsMap.get(nextId):null}}renderNavigationButtons(){const{previous:previous,next:next}=this.navigationButtons,renderButton=(btnElement,data)=>{if(!btnElement)return;const titleEl=btnElement.querySelector(this.selectors.TITLE),iconEl=btnElement.querySelector(this.selectors.ICON);data?(btnElement.classList.remove(this.classes.DISABLED),btnElement.setAttribute(this.attributes.SECTION_NUMBER,data.number),btnElement.setAttribute("href",data.sectionurl||"#"),iconEl&&iconEl.setAttribute(this.attributes.SECTION_NUMBER,data.number),titleEl&&(titleEl.textContent=data.title||"",titleEl.setAttribute("aria-label",data.title||""))):(btnElement.classList.add(this.classes.DISABLED),btnElement.removeAttribute("href"),btnElement.setAttribute(this.attributes.SECTION_NUMBER,""),titleEl&&(titleEl.textContent="",titleEl.removeAttribute("aria-label")))};renderButton(this.element.querySelector(this.selectors.PREVIOUS),previous),renderButton(this.element.querySelector(this.selectors.NEXT),next);const sectionEl=document.querySelector(this.selectors.SECTION);sectionEl&&sectionEl.setAttribute("id","section-".concat(this.section.number))}_getCmToSubsectionMapBySectionId(section){const result=new Map,cmIds=section.cmlist,cmState=this.reactive.state.cm;if(!cmIds||!Array.isArray(cmIds))return result;for(const cmid of cmIds){const cm=cmState.get(cmid);cm&&(void 0!==cm.delegatesectionid&&null!==cm.delegatesectionid&&result.set(cmid,cm.delegatesectionid))}return result}}return _exports.default=SectionNavigation,function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(SectionNavigation,"instances",new Map),_exports.default}));

//# sourceMappingURL=section_navigation.min.js.map